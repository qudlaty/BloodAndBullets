{"version":3,"sources":["services/index.ts","components/Game/Game.module.scss","helpers/index.ts","services/SquaresService/SquareClass.ts","services/SquaresService/SquaresService.ts","services/SquaresService/index.ts","services/EntitiesService/EntityFeatures.ts","services/EntitiesService/EntityClass.ts","services/EntitiesService/EntitiesService.ts","services/EntitiesService/index.ts","resources/ItemDefinitions.ts","helpers/Helpers.ts","services/GameModelService/GameModelService.ts","services/GameModelService/index.ts","resources/CharacterDefinitions.ts","components/Board/Board.module.scss","services/GameLogicService/index.ts","services/GameLogicService/GameLogicService.ts","services/ItemService/ItemClasses.ts","services/ItemService/index.ts","services/MessageService/MessageService.ts","services/MessageService/index.ts","services/GameActionsService/GameActionsService.tsx","services/GameActionsService/index.ts","components/Square/Blood.tsx","components/Square/Items.tsx","components/Square/Square.tsx","components/HpBar/HpBar.tsx","components/ShootingVisualization/ShootingVisualization.tsx","components/EntityPawn/EntityPawn.tsx","components/Board/Board.tsx","components/LinearDisplay/LinearDisplay.tsx","components/InventoryItem/InventoryItem.tsx","components/InventoryList/InventoryList.tsx","components/EntityCard/EntityCard.tsx","resources/StructureDefinitions.ts","components/Game/TargetedSquareInfo.tsx","components/Game/SelectedEntityInfo.tsx","components/MessageBox/MessageBox.tsx","components/Game/Game.tsx","components/HudPanel/HudPanel.tsx","components/EntitiesList/EntitiesList.tsx","components/Grid/Cell.tsx","components/Grid/Grid.tsx","components/Controls/Controls.tsx","screens/BlastZone/BlastZone.tsx","App.tsx","index.js"],"names":["module","exports","Square","squareType","item","this","addToInventory","inventory","HavingInventory","SquaresService","arenaSize","squares","i","initializeSquareIfEmpty","x","y","targetSquareIndex","value","squareIndex","Math","floor","entity","setEntityWithinASquare","position","square","amount","blood","Helpers","isTargeted","active","j","getSquare","isAvailableDestination","setSquare","forEach","isLit","isFriendly","isInTwilightZone","Identifiable","name","icon","Positionable","undefined","Movable","moveDestination","setMoveDestinationPosition","targetSquarePosition","targetPosition","targetSquare","isDead","isChosenDestination","MessageService","send","Mortal","hp","maxHp","Bleedable","bleeding","bleedingReductionPerTurn","bloodReleased","isAlive","bleed","addBlood","Breathing","isSupposedToBeBreathing","Combative","isShooting","ceaseFire","hasWeapon","targetedSquarePosition","itemName","actualItemIndex","findIndex","splice","push","HavingEquipment","equipment","unEquipFromHands","takeFromInventory","hands","Weapon","Entity","props","Object","assign","applyMixins","EntitiesService","entities","selected","id","filter","oldPositionX","oldPositionY","newSquare","isBreathing","potentialTargetEntity","targeted","selectedInEntities","findEntityById","getEntityId","console","log","damageApplied","weapon","isAbleToFire","fire","rounds","checkAmmoAndCalculateDamageApplied","getEntitiesAtGivenPosition","targetEntity","applyDamageToTargetEntity","ceaseFireNextTickIfTargetIsKilled","damage","chosenDestinationSquare","moveEntityIntoChosenDestination","moveEntityRandomly","M16","maxRounds","Rifle","M40","L30","Lazer","resetGivenFieldsOnACollection","collection","fieldNames","fieldName","getNumberWithinBoundaries","min","max","getRandomIntInclusive","random","calculateAngle","angle","atan","PI","calculateDistance","sqrt","pow","derivedCtor","baseCtors","baseCtor","getOwnPropertyNames","prototype","defineProperty","getOwnPropertyDescriptor","isSelectedTargeted","turnFlagsIntoClasses","flags","classNameBase","flagsToClassess","className","keys","key","newCopyOfArray","array","concat","getCssClassesForAGivenSquare","squareClassName","GameModel","saveMap","squaresProcessedForSave","JSON","parse","stringify","map","squaresStringified","result","window","prompt","localStorage","loadMap","mapNames","message","squaresLoaded","loadMapIntoBoard","index","sourceSquare","loadEntities","loadBuiltInMap","tutorial_map_00","loadPredefinedEntitities","characterDefinitions","age","entry","GameLogic","model","run","calculateNextInterfaceState","previousState","nextState","markAvailableDestinationsForSelectedEntity","syncSquaresWithEntities","length","setEntityWithinApropriateSquare","deselectAllEntities","moveEntities","isEntityShootingProperly","fireAShot","bleedExternally","stopBreathingForKilledEntity","enemiesAlive","calculateNumberOfAliveEnemies","amountOfAliveEnemies","causesBleeding","range","RangedWeapon","type","messages","component","GameActionsClass","that","toggleEditorMode","state","isEditorOn","setState","prevState","loop","stepNumber","drawAggro","processEntities","autoLoop","setTimeout","nextTick","handleClickV2","selectedSquareNumber","targetedSquareNumber","previousTargeted","doubleClick","markSquareAsTargeted","setMoveDestinationSquare","selectEntityFromGivenSquare","attackPosition","processInterface","aggro","actor","entitiesToAttack","findEntitiesThatAreClose","firstAmongThem","nuke","dmg","toggleRotateBoard","isBoardRotated","switchAutoLoop","onInventoryClick","entityId","actualEntity","equipInHands","handleDeselectAllEntities","calculateNextGameState","setSquaresAccordingToEntities","newlyFoundEntities","Blood","bloodAmount","bloodNumbers","style","left","top","background","toFixed","React","PureComponent","Items","itemsIcons","items","itemsNumber","SquareComponent","onClick","squareId","classPrefix","cuboidFaces","cuboid","HpBar","percentage","current","progressStyle","width","backgroundColor","color","Component","ShootingVisualization","calcNewAangle","targetCoords","projectileNumber","projectiles","localId","customStyle","distanceToTargetXInUnits","distanceToTargetYInUnits","actualDistanceInUnits","weaponType","projectile","EntityPawn","randomTime","classessFromFlags","fof","zIndex","animationBreathing","boardPadding","animation","Board","handleClick","EntityPawns","BoardSquares","colId","cellId","rowId","Array","size","fill","row","number","cells","cell","renderSquare","styles","board","isRotated","LinearDisplay","overload","title","divider","progressGridStyle","backgroundSize","backgroundImage","label","InventoryItem","reloadButton","dropButton","ammoCounter","onDrop","reload","onReload","InventoryList","inventoryItems","EntityCard","renderCount","handleInventoryClick","addItem","inHands","inHandsArray","clear","display","textAlign","structures","box","redBarrel","TargetedSquareInfo","boxSerialNumber","onItemClick","squareNumber","targetedSquare","structureType","newStructure","entityInfo","distanceInfo","positionInfo","bloodInfo","availableActions","editorButtons","onAddStructureClick","GameStyles","button","distanceToSelected","onMoveClick","onAttackClick","targeted__label","SelectedEntityInfo","selected__label","MessageBox","messageNumber","renderMessage","RenderedMessages","requestAnimationFrame","element","document","getElementById","scrollTop","scrollHeight","scrollElement","GameActions","Game","renderCounter","squareSize","game","status","game__board","fontSize","game__info","actions","zoomIn","zoomOut","checked","onChange","HudPanel","children","Cell","Grid","gridReference","scroll","mapdrag","stateDriven","createRef","deltaX","deltaY","executeScroll","rows","height","sourceY","startAt","currentRow","sourceX","currentCell","ref","onMouseDown","e","onMouseUp","onMouseMove","handleMove","onContextMenu","preventDefault","onDrag","onMouseDrag","scrollRelativeXY","movementX","movementY","event","target","onChangeScrollX","onChangeScrollY","switchStateDriven","renderGrid","Controls","w","s","a","d","addEventListener","onKeyDown","onKeyUp","keyCode","onKeyPress","BlastZone","gridX","gridY","controls","onControlPress","statusIndicators","App","scenes","SelectedScene","loadedScene","handleChange","bind","sceneToLoad","render"],"mappings":"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","file":"static/js/main.eaf66bbd.chunk.js","sourcesContent":["// Services - handlers of abstractions\r\nexport * from \"./EntitiesService\";\r\nexport * from \"./SquaresService\";\r\nexport * from \"./ItemService\";\r\nexport * from \"./MessageService\";\r\nexport * from \"./GameLogicService\";\r\nexport * from \"./GameModelService\";\r\nexport * from \"./GameActionsService\";","// extracted by mini-css-extract-plugin\nmodule.exports = {\"game\":\"Game_game__z9N4O\",\"game__board\":\"Game_game__board__1v352\",\"game__info\":\"Game_game__info__12BA-\",\"game__list\":\"Game_game__list__1xCA3\",\"status\":\"Game_status__37vaZ\",\"button\":\"Game_button__3-Wd7\",\"button-nuke\":\"Game_button-nuke__1eNG9\",\"actions\":\"Game_actions__1Mqsm\",\"interaction-container\":\"Game_interaction-container__2CXdJ\",\"selected\":\"Game_selected__1uYoa\",\"targeted\":\"Game_targeted__3RZBp\",\"selected__label\":\"Game_selected__label__12nSi\",\"targeted__label\":\"Game_targeted__label__3V3aH\",\"step-counter\":\"Game_step-counter__1Yl97\",\"auto-cycle\":\"Game_auto-cycle__2SCaT\",\"kbd-navigation\":\"Game_kbd-navigation__1gRT_\",\"square\":\"Game_square__1WOff\"};","// Helpers - various assorted tasks not fit to be in a service\r\nexport * from \"./Helpers\";\r\n","import { Item } from \"../ItemService\";\r\nimport { Entity, HavingInventory } from \"../EntitiesService\";\r\n\r\nexport interface Square {\r\n  entity?: Entity;\r\n  blood?: number;\r\n  squareType: string;\r\n  isAvailableDestination?: boolean;\r\n  isChosenDestination?: boolean;\r\n  isTargeted?: boolean;\r\n  isLit?: boolean;\r\n  isInTwilightZone?: boolean;\r\n  addItem(item: Item): void;\r\n}\r\n\r\nexport class Square extends HavingInventory implements Square {\r\n  public squareType: string = \"nothing\";\r\n  addItem(item: Item) {\r\n    this.addToInventory(item);\r\n  }\r\n  get items() {\r\n    return this.inventory;\r\n  }\r\n}\r\n","import * as Helpers from \"../../helpers/Helpers\";\r\nimport { Square } from \"./SquareClass\";\r\nimport { Entity, Position } from \"../EntitiesService\";\r\n\r\nclass SquaresServiceClass {\r\n  arenaSize: number = 10;\r\n\r\n  squares: Square[] = [];\r\n\r\n  constructor() {\r\n    let i = this.arenaSize * this.arenaSize;\r\n    while (i-- !== 0) {\r\n      this.initializeSquareIfEmpty(i);\r\n    }\r\n  }\r\n\r\n  getSquare(x: number, y: number): Square {\r\n    return this.squares[this.targetSquareIndex(x, y)];\r\n  }\r\n\r\n  setSquare(x: number, y: number, value): void {\r\n    this.squares[this.targetSquareIndex(x, y)] = value;\r\n  }\r\n\r\n  targetSquareIndex(x: number, y: number): number {\r\n    return y * this.arenaSize + x;\r\n  }\r\n\r\n  targetSquarePosition(squareIndex: number): Position {\r\n    let x: number, y: number;\r\n    y = Math.floor(squareIndex / this.arenaSize);\r\n    x = squareIndex % this.arenaSize;\r\n    return { x, y };\r\n  }\r\n\r\n  setEntityWithinApropriateSquare(entity: Entity): void {\r\n    this.setEntityWithinASquare(entity.position.x, entity.position.y, entity);\r\n  }\r\n\r\n  setEntityWithinASquare(x: number, y: number, entity: Entity) {\r\n    let squareIndex: number = this.targetSquareIndex(x, y);\r\n    this.initializeSquareIfEmpty(squareIndex);\r\n    this.squares[squareIndex].entity = entity;\r\n  }\r\n\r\n  addBlood(square: Square, amount: number) {\r\n    if (!square.blood) {\r\n      square.blood = amount;\r\n    } else {\r\n      square.blood += amount;\r\n    }\r\n  }\r\n\r\n  markSquareAsTargeted(squareIndex: number): void {\r\n    Helpers.resetGivenFieldsOnACollection(this.squares, \"isTargeted\");\r\n    this.initializeSquareIfEmpty(squareIndex);\r\n    this.squares[squareIndex].isTargeted = true;\r\n  }\r\n\r\n  initializeSquareIfEmpty(squareIndex: number) {\r\n    if (!this.squares[squareIndex]) {\r\n      this.squares[squareIndex] = new Square();\r\n    }\r\n  }\r\n\r\n  markAvailableDestinationsForSelectedEntity(entity: Entity): void {\r\n    if (entity.active) {\r\n      let { x, y } = entity.position;\r\n\r\n      Helpers.resetGivenFieldsOnACollection(this.squares, \"isAvailableDestination\");\r\n\r\n      for (let j = y - 1; j <= y + 1; j++) {\r\n        if (j < 0 || j >= this.arenaSize) {\r\n          continue;\r\n        }\r\n        for (let i = x - 1; i <= x + 1; i++) {\r\n          if (i < 0 || i >= this.arenaSize || (i === x && j === y)) {\r\n            continue;\r\n          }\r\n\r\n          let square: Square = this.getSquare(i, j);\r\n          if (square.squareType === \"floor\") {\r\n            square.isAvailableDestination = true;\r\n          }\r\n\r\n          this.setSquare(i, j, square);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  lightAllSquares(): void {\r\n    this.squares.forEach((square) => (square.isLit = true));\r\n  }\r\n  castLightsFromFriendlyEntity(entity: Entity): void {\r\n    if (entity.isFriendly) {\r\n      let { x, y } = entity.position;\r\n\r\n      for (let j = y - 2; j <= y + 2; j++) {\r\n        if (j < 0 || j >= this.arenaSize) {\r\n          continue;\r\n        }\r\n        for (let i = x - 2; i <= x + 2; i++) {\r\n          if (i < 0 || i >= this.arenaSize) {\r\n            continue;\r\n          }\r\n\r\n          let square: Square = this.getSquare(i, j);\r\n\r\n          square.isInTwilightZone = true;\r\n          this.setSquare(i, j, square);\r\n        }\r\n      }\r\n\r\n      for (let j = y - 1; j <= y + 1; j++) {\r\n        if (j < 0 || j >= this.arenaSize) {\r\n          continue;\r\n        }\r\n        for (let i = x - 1; i <= x + 1; i++) {\r\n          if (i < 0 || i >= this.arenaSize) {\r\n            continue;\r\n          }\r\n\r\n          let square: Square = this.getSquare(i, j);\r\n\r\n          square.isLit = true;\r\n          this.setSquare(i, j, square);\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n\r\nexport const SquaresService = new SquaresServiceClass();\r\n","export * from \"./SquaresService\";\r\nexport * from \"./SquareClass\";\r\n","import { Item, Weapon, Square } from \"..\";\r\nimport { SquaresService, MessageService } from \"..\";\r\nimport * as Helpers from \"../../helpers\";\r\n\r\n/** Position on a grid */\r\nexport interface Position {\r\n  x: number;\r\n  y: number;\r\n}\r\n\r\nexport class Identifiable {\r\n  name: string = \"An Entity\";\r\n  icon: string = \"E\";\r\n}\r\n\r\nexport class Positionable {\r\n  position: Position = { x: undefined, y: undefined };\r\n\r\n  get square(): Square {\r\n    let square = SquaresService.getSquare(this.position.x, this.position.y);\r\n    return square;\r\n  }\r\n}\r\n\r\nexport class Movable extends Identifiable {\r\n  moveDestination: Position;\r\n\r\n  setMoveDestinationSquare(squareIndex: number) {\r\n    this.setMoveDestinationPosition(SquaresService.targetSquarePosition(squareIndex));\r\n  }\r\n\r\n  setMoveDestinationPosition(targetPosition: Position) {\r\n    let targetSquare = SquaresService.getSquare(targetPosition.x, targetPosition.y);\r\n    if (!targetSquare.entity || targetSquare.entity.isDead) {\r\n      this.moveDestination = targetPosition;\r\n      Helpers.resetGivenFieldsOnACollection(SquaresService.squares, \"isChosenDestination\");\r\n      targetSquare.isChosenDestination = true;\r\n    } else {\r\n      MessageService.send(`${this.name} can't move into square (${targetPosition.x}, ${targetPosition.y})`);\r\n    }\r\n  }\r\n}\r\n\r\nexport class Mortal extends Positionable {\r\n  hp: number = 100;\r\n  maxHp: number = 100;\r\n  get isDead(): boolean {\r\n    return this.hp <= 0;\r\n  }\r\n  get isAlive(): boolean {\r\n    return this.hp > 0;\r\n  }\r\n}\r\n\r\nexport class Bleedable extends Mortal {\r\n  bleeding: number;\r\n  bleedingReductionPerTurn: number = 1;\r\n  bleed(): number {\r\n    let entity = this;\r\n    let bloodReleased = 0;\r\n    if (entity.bleeding && entity.isAlive) {\r\n      bloodReleased = entity.bleeding;\r\n      entity.hp -= bloodReleased;\r\n      entity.bleeding -= entity.bleedingReductionPerTurn;\r\n    }\r\n    return bloodReleased;\r\n  }\r\n\r\n  bleedExternally() {\r\n    if (!this.bleeding) return;\r\n    let entity = this;\r\n    let bloodReleased = this.bleed();\r\n    let square: Square = SquaresService.getSquare(entity.position.x, entity.position.y);\r\n    SquaresService.addBlood(square, bloodReleased);\r\n  }\r\n}\r\n\r\nexport class Breathing extends Mortal {\r\n  isSupposedToBeBreathing: boolean = undefined;\r\n  get isBreathing(): boolean {\r\n    return this.isAlive && this.isSupposedToBeBreathing;\r\n  }\r\n  set isBreathing(value: boolean) {\r\n    this.isSupposedToBeBreathing = value;\r\n  }\r\n}\r\n\r\nexport class Combative extends Identifiable {\r\n  targetPosition: Position;\r\n  isShooting?: boolean;\r\n  ceaseFire?: boolean;\r\n  hasWeapon?: boolean;\r\n  attackPosition(targetedSquarePosition: Position) {\r\n    if (this.hasWeapon) {\r\n      this.targetPosition = targetedSquarePosition;\r\n      this.isShooting = true;\r\n    } else {\r\n      MessageService.send(`${this.name} can't shoot - no weapon equipped`);\r\n    }\r\n  }\r\n}\r\n\r\nexport class HavingInventory {\r\n  inventory: Item[];\r\n  takeFromInventory(itemName: string): Item {\r\n    let actualItemIndex = this.inventory.findIndex((item) => item.name === itemName);\r\n    let actualItem = this.inventory.splice(actualItemIndex, 1)[0];\r\n\r\n    return actualItem;\r\n  }\r\n  addToInventory(item: Item) {\r\n    if (!this.inventory) {\r\n      this.inventory = [];\r\n    }\r\n    this.inventory.push(item);\r\n  }\r\n}\r\n\r\nexport class HavingEquipment extends HavingInventory {\r\n  equipment: any;\r\n  hasWeapon?: boolean;\r\n\r\n  equipInHands(itemName: string) {\r\n    this.unEquipFromHands();\r\n    let item = this.takeFromInventory(itemName);\r\n    this.equipment.hands = item;\r\n    if (item instanceof Weapon) {\r\n      this.hasWeapon = true;\r\n    } else {\r\n      this.hasWeapon = false;\r\n    }\r\n  }\r\n\r\n  unEquipFromHands() {\r\n    if (this.equipment.hands) {\r\n      this.inventory.push(this.equipment.hands);\r\n      this.equipment.hands = null;\r\n      this.hasWeapon = false;\r\n    }\r\n  }\r\n}\r\n","import { applyMixins } from \"../../helpers\";\r\nimport {\r\n  Identifiable,\r\n  Positionable,\r\n  Mortal,\r\n  Bleedable,\r\n  Movable,\r\n  Breathing,\r\n  Combative,\r\n  HavingInventory,\r\n  HavingEquipment,\r\n} from \".\";\r\n\r\nexport class Entity {\r\n  // Extended by mixins below\r\n  constructor(...props) {\r\n    Object.assign(this, ...props);\r\n  }\r\n  isFriendly?: boolean;\r\n  active?: boolean;\r\n}\r\n\r\n/************************************************************/\r\n/* Always update both lists */\r\n\r\nexport interface Entity\r\n  extends Identifiable,\r\n    Positionable,\r\n    Mortal,\r\n    Bleedable,\r\n    Movable,\r\n    Breathing,\r\n    Combative,\r\n    HavingInventory,\r\n    HavingEquipment {}\r\napplyMixins(Entity, [\r\n  Identifiable,\r\n  Positionable,\r\n  Mortal,\r\n  Bleedable,\r\n  Movable,\r\n  Breathing,\r\n  Combative,\r\n  HavingInventory,\r\n  HavingEquipment,\r\n]);\r\n\r\n/************************************************************/\r\n","import { Entity, Position, HavingInventory } from \".\";\r\nimport { SquaresService, Square } from \"../SquaresService\";\r\nimport * as Helpers from \"../../helpers/Helpers\";\r\nimport { RangedWeapon } from \"../\";\r\nconst arenaSize: number = 10;\r\n\r\nclass EntitiesServiceClass {\r\n  entities: Entity[];\r\n  selected: Entity;\r\n\r\n  getEntityId(entity: Entity): string {\r\n    return entity.name;\r\n  }\r\n\r\n  findEntityById(id: string): Entity {\r\n    let result: Entity = this.entities.filter((entity) => entity.name === id)[0];\r\n    return result;\r\n  }\r\n\r\n  findItemOnEntity(entity: HavingInventory, id: string) {\r\n    let result = entity.inventory.filter((item) => item.name === id)[0];\r\n    return result;\r\n  }\r\n\r\n  moveEntityRandomly(entity: Entity) {\r\n    if (entity.isDead) return;\r\n\r\n    let oldPositionX = entity.position.x;\r\n    let oldPositionY = entity.position.y;\r\n\r\n    entity.position.x = entity.position.x + Helpers.getRandomIntInclusive(-1, 1);\r\n    entity.position.y = entity.position.y + Helpers.getRandomIntInclusive(-1, 1);\r\n\r\n    entity.position.x = Helpers.getNumberWithinBoundaries(entity.position.x, 0, arenaSize - 1);\r\n    entity.position.y = Helpers.getNumberWithinBoundaries(entity.position.y, 0, arenaSize - 1);\r\n\r\n    let newSquare = SquaresService.getSquare(entity.position.x, entity.position.y);\r\n\r\n    if ((newSquare && newSquare.entity) || (newSquare && newSquare.squareType !== \"floor\")) {\r\n      // if square occupiec, reverse the move\r\n      entity.position.x = oldPositionX;\r\n      entity.position.y = oldPositionY;\r\n    }\r\n  }\r\n\r\n  stopBreathingForKilledEntity(entity: Entity): Entity {\r\n    if (entity && entity.hp <= 0) {\r\n      entity.isBreathing = false;\r\n      entity.isShooting = false;\r\n      entity.hp = 0;\r\n    }\r\n    return entity;\r\n  }\r\n\r\n  getEntitiesAtGivenPosition(targetPosition: Position): Entity[] {\r\n    return this.entities.filter((potentialTargetEntity: Entity): boolean => {\r\n      return (\r\n        potentialTargetEntity.position.x === targetPosition.x && potentialTargetEntity.position.y === targetPosition.y\r\n      );\r\n    });\r\n  }\r\n\r\n  selectEntityFromGivenSquare(selected: Entity, targeted: Square): Entity {\r\n    if (selected && targeted && targeted.entity) {\r\n      selected.active = false;\r\n    }\r\n    if (targeted && targeted.entity) {\r\n      selected = targeted.entity;\r\n      selected.active = true;\r\n    }\r\n\r\n    return selected;\r\n  }\r\n\r\n  setSelected(selected: Entity, value: boolean): Entity {\r\n    let selectedInEntities = this.findEntityById(this.getEntityId(selected));\r\n    if (value) {\r\n      selected.active = value;\r\n    } else {\r\n      selected = null;\r\n      console.log(\"Nullified:\", selected);\r\n    }\r\n    selectedInEntities.active = value;\r\n    return selected;\r\n  }\r\n\r\n  checkAmmoAndCalculateDamageApplied(entity: Entity): number {\r\n    let damageApplied: number = 0;\r\n    let weapon: RangedWeapon = entity.equipment && entity.equipment.hands;\r\n\r\n    if (!weapon) return 0;\r\n\r\n    if (weapon.isAbleToFire) {\r\n      damageApplied = weapon.fire();\r\n    } else {\r\n      weapon.rounds = \"empty\";\r\n      entity.isShooting = false;\r\n    }\r\n\r\n    return damageApplied;\r\n  }\r\n\r\n  fireAShot(entity: Entity) {\r\n    if (entity.ceaseFire) {\r\n      entity.isShooting = false;\r\n      entity.ceaseFire = false;\r\n      return;\r\n    }\r\n    let damageApplied = this.checkAmmoAndCalculateDamageApplied(entity);\r\n    let targetEntities = this.getEntitiesAtGivenPosition(entity.targetPosition);\r\n    targetEntities.forEach((targetEntity) => {\r\n      this.applyDamageToTargetEntity(targetEntity, damageApplied);\r\n      this.ceaseFireNextTickIfTargetIsKilled(entity, targetEntity);\r\n    });\r\n  }\r\n\r\n  applyDamageToTargetEntity(targetEntity: Entity, damage: number) {\r\n    if (damage) {\r\n      targetEntity.hp -= damage;\r\n      targetEntity.bleeding = 5;\r\n    }\r\n  }\r\n\r\n  ceaseFireNextTickIfTargetIsKilled(entity: Entity, targetEntity: Entity): void {\r\n    if (targetEntity.hp < 0) {\r\n      entity.ceaseFire = true;\r\n    }\r\n  }\r\n\r\n  isEntityShootingProperly(entity: Entity): boolean {\r\n    return (\r\n      entity.isShooting &&\r\n      entity.targetPosition &&\r\n      (entity.targetPosition.x !== entity.position.x || entity.targetPosition.y !== entity.position.y)\r\n    );\r\n  }\r\n\r\n  applyEffectsOfBleeding(entity: Entity): Entity {\r\n    // TODO: move to a \"bleed\" method\r\n    if (entity.bleeding && entity.hp > 0) {\r\n      entity.hp -= entity.bleeding;\r\n      let square: Square = SquaresService.getSquare(entity.position.x, entity.position.y);\r\n      SquaresService.addBlood(square, entity.bleeding);\r\n      entity.bleeding -= entity.bleedingReductionPerTurn;\r\n    }\r\n    return entity;\r\n  }\r\n\r\n  moveEntityIntoChosenDestination(entity: Entity): Entity {\r\n    if (!entity.isDead && entity.moveDestination) {\r\n      let chosenDestinationSquare: Square = SquaresService.getSquare(\r\n        entity.moveDestination.x,\r\n        entity.moveDestination.y\r\n      );\r\n\r\n      entity.position = entity.moveDestination;\r\n      delete entity.moveDestination;\r\n      chosenDestinationSquare.isChosenDestination = undefined;\r\n    }\r\n    return entity;\r\n  }\r\n\r\n  setMoveDestinationOnASelectedEntity(selected: Entity, targetedSquarePosition: Position): void {\r\n    selected.moveDestination = targetedSquarePosition;\r\n  }\r\n\r\n  moveEntities(): void {\r\n    this.entities.forEach((entity) => this.moveEntityIntoChosenDestination(entity));\r\n    // let OP: Entity = this.findEntityById(\"Squid\");\r\n    // let OC: Entity = this.findEntityById(\"Octo\");\r\n    // //this.moveEntityRandomly(JR);\r\n    // this.moveEntityRandomly(OP);\r\n    // this.moveEntityRandomly(OC);\r\n    this.entities.filter(entity => !entity.isFriendly).forEach((entity) => {\r\n      this.moveEntityRandomly(entity);\r\n    });\r\n  }\r\n}\r\n\r\nexport const EntitiesService = new EntitiesServiceClass();\r\n","export * from \"./EntityFeatures\";\r\nexport * from \"./EntityClass\";\r\nexport * from \"./EntitiesService\";\r\n","import { Rifle, Lazer } from \"../services\";\r\n\r\nexport class M16 extends Rifle {\r\n  name = \"M16\";\r\n  rounds = 15;\r\n  maxRounds = 20;\r\n  damage = 2;\r\n}\r\n\r\nexport class M40 extends Rifle {\r\n  name = \"M41A Pulse Rifle\";\r\n  rounds = 40;\r\n  maxRounds = 40;\r\n  damage = 1;\r\n}\r\n\r\nexport class L30 extends Lazer {\r\n  name = \"Assault Lazer Cannon\";\r\n  rounds = 30;\r\n  maxRounds = 30;\r\n  damage = 3;\r\n}\r\n","import { Entity } from \"../services/EntitiesService\";\r\nimport { Square } from \"../services/SquaresService\";\r\n\r\n/** @description\r\n * Takes a collection and a list of strings describing object keys.\r\n * Sets all given fields on a collection to `undefined`\r\n */\r\nexport function resetGivenFieldsOnACollection(collection, ...fieldNames) {\r\n  collection.forEach((item) => {\r\n    fieldNames.forEach((fieldName) => {\r\n      item && (item[fieldName] = undefined);\r\n    });\r\n  });\r\n}\r\n\r\n/** @description Takes a number and fits it within given boundaries, then returns it */\r\nexport function getNumberWithinBoundaries(value: number, min: number, max: number): number {\r\n  if (value < min) value = min;\r\n  if (value > max) value = max;\r\n  return value;\r\n}\r\n\r\n/** @description Returns a random integer between min and max */\r\nexport function getRandomIntInclusive(min: number, max: number): number {\r\n  return Math.floor(Math.random() * (max - min + 1)) + min;\r\n}\r\n\r\n/** @description Returns angle (in degrees) of a given vector */\r\nexport function calculateAngle(x: number, y: number): number {\r\n  let angle: number;\r\n  if (y >= 0) {\r\n    angle = -Math.atan(x / y) * (180 / Math.PI);\r\n  } else if (y < 0) {\r\n    angle = (180 / Math.PI) * (Math.atan(x / -y) + Math.PI);\r\n  }\r\n  return angle;\r\n}\r\n\r\n/** @description Pitagorean distance between 0,0 and given coords */\r\nexport function calculateDistance(x: number, y: number): number {\r\n  return Math.sqrt(Math.pow(x, 2) + Math.pow(y, 2));\r\n}\r\n\r\n/** @description Mixing classess together */\r\nexport function applyMixins(derivedCtor: any, baseCtors: any[]) {\r\n  // see https://www.typescriptlang.org/docs/handbook/mixins.html\r\n  baseCtors.forEach((baseCtor) => {\r\n    Object.getOwnPropertyNames(baseCtor.prototype).forEach((name) => {\r\n      Object.defineProperty(derivedCtor.prototype, name, Object.getOwnPropertyDescriptor(baseCtor.prototype, name));\r\n    });\r\n  });\r\n}\r\n\r\n/** @description Checking if selected entity is on a targeted square */\r\nexport function isSelectedTargeted(selected: Entity, targeted: Square): boolean {\r\n  if (selected && targeted && targeted.entity && selected.name === targeted.entity.name) {\r\n    return true;\r\n  } else {\r\n    return false;\r\n  }\r\n}\r\n\r\n/**\r\n * @description\r\n * Adding classess apropriate to the flags passed in by props\r\n * @param classNameBase - if given, it is added in front of the classname with \"--\"\r\n * Eg: classNameBase--class-from-flag\r\n */\r\nexport function turnFlagsIntoClasses(flags: object, classNameBase?: string) {\r\n  if(!flags) return '';\r\n  const flagsToClassess = {\r\n    active: \"active\",\r\n    isAvailableDestination: \"is-available-destination\",\r\n    isChosenDestination: \"is-chosen-destination\",\r\n    isBreathing: \"breathing\",\r\n    isDead: \"dead\",\r\n    isShooting: \"shooting\",\r\n    isTargeted: \"targeted\",\r\n    isLit: \"is-lit\",\r\n    isInTwilightZone: \"is-in-twilight-zone\",\r\n  };\r\n\r\n  let className = \"\";\r\n\r\n  if (classNameBase) {\r\n    classNameBase += \"--\";\r\n  } else {\r\n    classNameBase = \"\";\r\n  }\r\n\r\n  Object.keys(flagsToClassess).forEach((key) => {\r\n    if (flags[key]) {\r\n      className += ` ${classNameBase}${flagsToClassess[key]}`;\r\n    }\r\n  });\r\n  return className;\r\n}\r\n\r\n/**\r\n * @description\r\n * Creates a new array containing all the elements from a given array\r\n * @param array array to shallow-copy\r\n * @yields a new copy of the array\r\n */\r\nexport function newCopyOfArray(array: any[]) {\r\n  return [].concat(array);\r\n}\r\n\r\n/**\r\n * @description\r\n * Returns a string with set of CSS classes\r\n * based on the flags found in the given square.\r\n * @param square a square to style\r\n * @yields string with all classess applicable for the given square\r\n */\r\nexport function getCssClassesForAGivenSquare(square: Square): string {\r\n  if(!square) return;\r\n  let squareClassNameBase = \"square\";\r\n  let squareClassName = `${squareClassNameBase} ${square && square.squareType}`;\r\n  squareClassName += turnFlagsIntoClasses(square, squareClassNameBase);\r\n  if (square.entity) {\r\n    squareClassName += turnFlagsIntoClasses(square.entity, squareClassNameBase);\r\n  }\r\n  return squareClassName;\r\n}\r\n","import { SquaresService, Square } from \"../SquaresService\";\r\nimport { EntitiesService } from \"../EntitiesService\";\r\nimport tutorial_map_00 from \"../../resources/maps/tutorial_map_00.json\"; // yes, it's a resource named with snake_case\r\nimport { characterDefinitions } from \"../../resources/CharacterDefinitions\";\r\nimport { Entity } from \"../EntitiesService\";\r\n\r\nclass GameModelClass {\r\n  entities;\r\n  squares;\r\n  selected;\r\n\r\n  constructor() {\r\n    this.entities = EntitiesService.entities;\r\n    this.squares = SquaresService.squares;\r\n  }\r\n\r\n  saveMap = () => {\r\n    let squares: Square[] = JSON.parse(JSON.stringify(SquaresService.squares));\r\n    let squaresProcessedForSave = squares.map((square) => {\r\n      //let newSquare = { squareType: square.squareType, entity: square.entity };\r\n\r\n      return square;\r\n    });\r\n    let squaresStringified = JSON.stringify(squaresProcessedForSave);\r\n    console.log(squaresStringified);\r\n    let message = \"Enter the name of saved map.\";\r\n    let mapName = \"map00\";\r\n\r\n    let result = window.prompt(message, mapName);\r\n\r\n    localStorage[result] = squaresStringified;\r\n  };\r\n\r\n  loadMap = () => {\r\n    let mapNames = Object.keys(localStorage);\r\n    let message = `Enter the name of map to load. ${mapNames}`;\r\n    let mapName = \"map00\";\r\n    let result = window.prompt(message, mapName);\r\n    let squaresStringified = localStorage[result];\r\n\r\n    console.log(squaresStringified);\r\n    let squaresLoaded = JSON.parse(squaresStringified);\r\n    this.loadMapIntoBoard(squaresLoaded);\r\n  };\r\n\r\n  loadMapIntoBoard = (squaresLoaded) => {\r\n    SquaresService.squares.forEach((square, index) => {\r\n      let targetSquare = square;\r\n      let sourceSquare = squaresLoaded[index];\r\n      targetSquare.squareType = sourceSquare && sourceSquare.squareType || 'floor';\r\n    });\r\n  };\r\n\r\n  loadEntities = (entities: Entity[]) => {\r\n    EntitiesService.entities = entities;\r\n  };\r\n\r\n  loadBuiltInMap = () => {\r\n    this.loadMapIntoBoard(tutorial_map_00);\r\n  };\r\n\r\n  loadPredefinedEntitities = () => {\r\n    this.loadEntities(characterDefinitions);\r\n  };\r\n}\r\n\r\nexport const GameModel = new GameModelClass();\r\n\r\nexport default GameModel;\r\n","export * from \"./GameModelService\";\r\n","import { M16, M40, L30 } from \"./ItemDefinitions\";\r\nimport { Entity } from \"../services\";\r\n\r\nexport const entitiesInitialValues = [\r\n  {\r\n    name: \"Lazer Blady\",\r\n    age: 60,\r\n    hp: 75,\r\n    maxHp: 100,\r\n    icon: \"\",\r\n    isBreathing: true,\r\n    isFriendly: true,\r\n    hasWeapon: true,\r\n    position: { x: 4, y: 8 },\r\n    inventory: [new M16()],\r\n    equipment: {hands: new L30()},\r\n  },\r\n  {\r\n    name: \"Robot\",\r\n    age: 1,\r\n    hp: 50,\r\n    maxHp: 50,\r\n    icon: \"\",\r\n    isBreathing: false,\r\n    position: { x: 3, y: 5 },\r\n    equipment: {hands: new L30()},\r\n    inventory: [],\r\n    hasWeapon: true,\r\n  },\r\n  {\r\n    name: \"Octo\",\r\n    age: 8,\r\n    hp: 200,\r\n    maxHp: 200,\r\n    icon: \"\",\r\n    isBreathing: true,\r\n    position: { x: 8, y: 2 },\r\n    bleedingReductionPerTurn: 0,\r\n    bleeding: 1,\r\n    equipment: {hands: new L30()},\r\n    inventory: [],\r\n    hasWeapon: true,\r\n  },\r\n  {\r\n    name: \"Squid\",\r\n    age: 5,\r\n    hp: 100,\r\n    maxHp: 100,\r\n    icon: \"\",\r\n    isBreathing: true,\r\n    position: { x: 5, y: 5 },\r\n    equipment: {hands: new M40()},\r\n    inventory: [],\r\n    hasWeapon: true,\r\n  },\r\n  {\r\n    name: \"Ant\",\r\n    age: 1,\r\n    hp: 45,\r\n    maxHp: 50,\r\n    icon: \"\",\r\n    isBreathing: true,\r\n    position: { x: 7, y: 6 },\r\n    equipment: {hands: new M40()},\r\n    inventory: [],\r\n    hasWeapon: true,\r\n  },\r\n  {\r\n    name: \"Henry The Spider\",\r\n    age: 1,\r\n    hp: 100,\r\n    maxHp: 150,\r\n    icon: \"\",\r\n    isBreathing: true,\r\n    position: { x: 9, y: 3 },\r\n    bleedingReductionPerTurn: 1,\r\n    equipment: {hands: new L30()},\r\n    inventory: [],\r\n    hasWeapon: true,\r\n  },\r\n  {\r\n    name: \"Mosquito\",\r\n    age: 1,\r\n    hp: 12,\r\n    maxHp: 20,\r\n    icon: \"\",\r\n    isBreathing: true,\r\n    position: { x: 2, y: 7 },\r\n    equipment: {hands: new M16()},\r\n    inventory: [],\r\n    hasWeapon: true,\r\n  },\r\n  {\r\n    name: \"Microbe\",\r\n    age: 1,\r\n    hp: 1,\r\n    maxHp: 5,\r\n    icon: \"\",\r\n    isBreathing: true,\r\n    position: { x: 1, y: 5 },\r\n    equipment: {hands: new L30()},\r\n    inventory: [],\r\n    hasWeapon: true,\r\n  },\r\n];\r\n\r\nexport const characterDefinitions = entitiesInitialValues.map((entry) => new Entity(entry));\r\nexport default characterDefinitions;\r\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"board\":\"Board_board__2qEwH\",\"board__row\":\"Board_board__row__3JNmW\",\"board--rotated\":\"Board_board--rotated__1SMxV\"};","export * from \"./GameLogicService\";\r\nexport * from \"./GameState\";","import { GameModel } from \"../GameModelService\";\r\nimport { SquaresService, Square } from \"../SquaresService\";\r\nimport { EntitiesService } from \"../EntitiesService\";\r\nimport { Entity } from \"../EntitiesService\";\r\nimport * as Helpers from \"../../helpers\";\r\n\r\nimport { GameState } from \"./GameState\";\r\nclass GameLogicClass {\r\n  model;\r\n\r\n  constructor() {\r\n    this.model = GameModel;\r\n  }\r\n\r\n  run = () => {\r\n    console.log(\"Running Game Logic\");\r\n    console.log(GameModel.entities);\r\n  };\r\n\r\n  calculateNextInterfaceState = (previousState: GameState) => {\r\n    let nextState = previousState;\r\n    let { entities, selected } = nextState;\r\n    entities.forEach((entity) => {\r\n      if (entity === selected) SquaresService.markAvailableDestinationsForSelectedEntity(selected);\r\n    });\r\n\r\n    return nextState;\r\n  };\r\n\r\n  /**\r\n   * Calculate WHAT EXACTLY? This should probably go into GameLogic\r\n   * @param previousState\r\n   */\r\n  calculateNextGameState(previousState: GameState) {\r\n    let nextState: GameState = previousState;\r\n    let { entities } = nextState;\r\n\r\n    EntitiesService.moveEntities();\r\n    //Helpers.resetGivenFieldsOnACollection(squares, \"isLit\", \"isInTwilightZone\");\r\n    //SquaresService.lightAllSquares();\r\n    entities.forEach((entity) => {\r\n      if (EntitiesService.isEntityShootingProperly(entity)) {\r\n        EntitiesService.fireAShot(entity);\r\n      }\r\n      entity.bleedExternally();\r\n\r\n      EntitiesService.stopBreathingForKilledEntity(entity);\r\n\r\n      SquaresService.markAvailableDestinationsForSelectedEntity(entity);\r\n      // SquaresService.castLightsFromFriendlyEntity(entity);\r\n    });\r\n\r\n    nextState.enemiesAlive = this.calculateNumberOfAliveEnemies(entities);\r\n    console.log(nextState.enemiesAlive);\r\n    return nextState;\r\n  }\r\n\r\n  calculateNumberOfAliveEnemies(entities: Entity[]):number {\r\n    let amountOfAliveEnemies = 0;\r\n    entities.forEach((entity) => {\r\n      if(entity.isFriendly) {\r\n        return;\r\n      } else if(entity.hp > 0) {\r\n        amountOfAliveEnemies++;\r\n      }\r\n    });\r\n\r\n    return amountOfAliveEnemies;\r\n  }\r\n\r\n  syncSquaresWithEntities = (previousState) => {\r\n    let squares: Square[] = Helpers.newCopyOfArray(previousState.squares);\r\n    /*\r\n    Reattach new squares array to the SquaresService\r\n    This might actually be not-needed, as elements of that array are objects\r\n    and are referenced in both arrays, so unless we're adding new squares,\r\n    everything should work without re-attaching\r\n    */\r\n    SquaresService.squares = squares;\r\n    let entities: Entity[] = previousState.entities;\r\n    if (entities.length) {\r\n      Helpers.resetGivenFieldsOnACollection(squares, \"entity\");\r\n    }\r\n    entities.forEach((entity) => {\r\n      SquaresService.setEntityWithinApropriateSquare(entity);\r\n    });\r\n\r\n    return { squares };\r\n  };\r\n\r\n  deselectAllEntities = () => {\r\n    Helpers.resetGivenFieldsOnACollection(EntitiesService.entities, \"active\");\r\n    Helpers.resetGivenFieldsOnACollection(SquaresService.squares, \"isChosenDestination\", \"isAvailableDestination\");\r\n  };\r\n\r\n  ceaseFire = () => {\r\n    Helpers.resetGivenFieldsOnACollection(GameModel.entities, \"isShooting\");\r\n  };\r\n}\r\n\r\nexport const GameLogic = new GameLogicClass();\r\nexport default GameLogic;\r\n","export class Item {\r\n  name: string = \"\";\r\n}\r\n\r\nexport class Weapon extends Item {\r\n  causesBleeding = 0;\r\n  range = 0;\r\n  damage = 0;\r\n}\r\n\r\nexport class RangedWeapon extends Weapon {\r\n  rounds: number | any = 0;\r\n  maxRounds = 5;\r\n\r\n  fire() {\r\n    this.rounds--;\r\n    console.log(\"Firing ranged weapon. Damage: \", this.damage);\r\n    return this.damage;\r\n  }\r\n\r\n  get isAbleToFire() {\r\n    return this.rounds > 0;\r\n  }\r\n\r\n  reload() {\r\n    this.rounds = this.maxRounds;\r\n  }\r\n}\r\n\r\n// TODO: Should add kinetic/thermal damage\r\nexport class Rifle extends RangedWeapon {\r\n  type = \"projectile\";\r\n  range = 4;\r\n  damage = 1;\r\n  causesBleeding = 2;\r\n}\r\n\r\nexport class Lazer extends RangedWeapon {\r\n  type = \"lazer\";\r\n  range = 6;\r\n  damage = 5;\r\n  causesBleeding = 0;\r\n}\r\n","export * from \"./ItemClasses\";\r\n","class MessageServiceClass {\r\n  messages: string[] = [];\r\n  send(message: string) {\r\n    this.messages.push(message);\r\n  }\r\n}\r\n\r\nexport const MessageService = new MessageServiceClass();\r\n\r\nexport default MessageService;\r\n","export * from \"./MessageService\";\r\n","/** This file contains most of the click-handling logic for the Game */\r\n/* Handling of particular events is delegated to proper services */\r\n\r\nimport * as Helpers from \"../../helpers\";\r\nimport { Entity, EntitiesService, SquaresService, GameLogic, Position } from \"../../services\";\r\n\r\nlet component = null;\r\nexport class GameActionsClass {\r\n  constructor(that) {\r\n    component = that;\r\n  }\r\n  toggleEditorMode = () => {\r\n    if (!component.state.isEditorOn) {\r\n      Helpers.resetGivenFieldsOnACollection(component.state.squares, \"blood\", \"entity\");\r\n      component.setState((prevState) => {\r\n        return { entities: [], isEditorOn: true };\r\n      });\r\n    } else {\r\n      component.setState((prevState) => {\r\n        return { squares: SquaresService.squares, entities: EntitiesService.entities, isEditorOn: false };\r\n      });\r\n    }\r\n  };\r\n\r\n  loop = () => {\r\n    component.stepNumber++;\r\n    this.drawAggro();\r\n    this.processEntities();\r\n    if (component.state.autoLoop) {\r\n      setTimeout(this.loop, 1000);\r\n    }\r\n  };\r\n\r\n  processEntities() {\r\n    component.setState(\r\n      (prevState) => GameLogic.calculateNextGameState(prevState),\r\n      () => this.setSquaresAccordingToEntities()\r\n    );\r\n  }\r\n\r\n  processInterface() {\r\n    component.setState(\r\n      (prevState) => GameLogic.calculateNextInterfaceState(prevState),\r\n      () => this.setSquaresAccordingToEntities()\r\n    );\r\n  }\r\n\r\n  /** Sets entities within apropriate squares, based on the value of their `position` field\r\n   * This might actually be not-needed, if movement of entities is reflected in their respectable squares\r\n   * Also: entities are no longer rendered within `Square` component\r\n   */\r\n  setSquaresAccordingToEntities() {\r\n    component.setState((prevState) => GameLogic.syncSquaresWithEntities(prevState));\r\n  }\r\n\r\n  nextTick = () => {\r\n    component.setState({ autoLoop: false });\r\n    this.loop();\r\n  };\r\n\r\n  handleClickV2 = (squareIndex: number) => {\r\n    component.setState(\r\n      (state) => {\r\n        let { squares, entities, selected, targeted, isEditorOn, targetedSquareNumber: selectedSquareNumber } = state;\r\n        let previousTargeted = targeted;\r\n        targeted = squares[squareIndex];\r\n        selectedSquareNumber = squareIndex;\r\n        const doubleClick = () => previousTargeted === targeted;\r\n        SquaresService.markSquareAsTargeted(squareIndex);\r\n\r\n        if (isEditorOn) {\r\n          switch (targeted.squareType) {\r\n            case \"floor\":\r\n              targeted.squareType = \"wall\";\r\n              break;\r\n            case \"wall\":\r\n              targeted.squareType = \"nothing\";\r\n              break;\r\n            case \"nothing\":\r\n            default:\r\n              targeted.squareType = \"floor\";\r\n          }\r\n        }\r\n\r\n        /** Setting move destination while clicking on empty square */\r\n        if (doubleClick() && targeted.isAvailableDestination) {\r\n          selected.setMoveDestinationSquare(squareIndex);\r\n        }\r\n\r\n        /** To be able to deselect */\r\n        if (doubleClick() || selected) {\r\n          if (!selected && targeted.entity) {\r\n            // Selecting\r\n            selected = EntitiesService.selectEntityFromGivenSquare(selected, targeted);\r\n            //targeted = undefined;\r\n          } else if (Helpers.isSelectedTargeted(selected, targeted)) {\r\n            // Deselecting if not selecting\r\n            /* // DISABLE DOUBLECLICK DESELECT\r\n            GameLogic.deselectAllEntities();\r\n            selected = undefined;\r\n            // */\r\n          }\r\n        }\r\n\r\n        // setting attack\r\n        if (doubleClick() && selected && targeted.entity && selected !== targeted.entity) {\r\n          selected.attackPosition(SquaresService.targetSquarePosition(squareIndex));\r\n        }\r\n\r\n        return { squares, entities, selected, targeted, targetedSquareNumber: selectedSquareNumber };\r\n      },\r\n      () => this.processInterface()\r\n    );\r\n  };\r\n\r\n  drawAggro() {\r\n    EntitiesService.entities.forEach((entity)=>{\r\n      if(entity.isFriendly) return;\r\n      entity.isShooting = false;\r\n      this.aggro(entity.name);\r\n    })\r\n  }\r\n\r\n  aggro = (name) => {\r\n    let actor = EntitiesService.findEntityById(name);\r\n    let position = actor.position;\r\n    let closeEntities = this.findEntitiesThatAreClose(position);\r\n    let entitiesToAttack = closeEntities.filter(entity => entity.hp > 0);\r\n    if(entitiesToAttack.length) {\r\n      let firstAmongThem = entitiesToAttack[0];\r\n      actor.attackPosition(firstAmongThem.position);\r\n    }\r\n  }\r\n\r\n  findEntitiesThatAreClose(position: Position){\r\n    let {x, y} = position;\r\n    let entities: Entity[] = [];\r\n    for (let j = y - 1; j <= y + 1; j++) {\r\n      if (j < 0 || j >= SquaresService.arenaSize) {\r\n        continue;\r\n      }\r\n      for (let i = x - 1; i <= x + 1; i++) {\r\n        if (i < 0 || i >= SquaresService.arenaSize || (i === x && j === y)) {\r\n          continue;\r\n        }\r\n        let newlyFoundEntities = EntitiesService.getEntitiesAtGivenPosition({x: i, y: j})\r\n        entities = entities.concat(newlyFoundEntities);\r\n      }\r\n    }\r\n\r\n    return entities;\r\n  }\r\n\r\n  nuke = (dmg: number) => {\r\n    component.setState(\r\n      (state) => {\r\n        let { entities } = state;\r\n\r\n        entities.forEach((entity) => {\r\n          entity.hp = entity.hp - dmg;\r\n        });\r\n\r\n        return { entities };\r\n      },\r\n      () => {\r\n        this.processEntities();\r\n      }\r\n    );\r\n  };\r\n\r\n  toggleRotateBoard = () => {\r\n    component.setState({ isBoardRotated: !component.state.isBoardRotated });\r\n  };\r\n\r\n  switchAutoLoop = () => {\r\n    component.setState(\r\n      (previousState) => {\r\n        return { autoLoop: !previousState.autoLoop };\r\n      },\r\n      () => {\r\n        if (component.state.autoLoop) {\r\n          this.loop();\r\n        }\r\n      }\r\n    );\r\n  };\r\n\r\n  onInventoryClick = (entity: Entity, itemName: string) => {\r\n    component.setState((prevState) => {\r\n      let entities = [].concat(prevState.entities);\r\n      EntitiesService.entities = entities;\r\n      let entityId = EntitiesService.getEntityId(entity);\r\n      let actualEntity = EntitiesService.findEntityById(entityId);\r\n      //let actualItem = EntitiesService.findItemOnEntity(actualEntity, itemName);\r\n\r\n      if (actualEntity.equipment.hands && actualEntity.equipment.hands.name === itemName) {\r\n        actualEntity.unEquipFromHands();\r\n      } else {\r\n        actualEntity.equipInHands(itemName);\r\n      }\r\n\r\n      return { entities };\r\n    });\r\n    console.log(entity, itemName);\r\n  };\r\n\r\n  handleDeselectAllEntities = () => {\r\n    component.setState(\r\n      (state) => {\r\n        let { squares, entities, selected } = state;\r\n\r\n        GameLogic.deselectAllEntities();\r\n        selected = undefined;\r\n\r\n        return { squares, entities, selected };\r\n      },\r\n      () => {\r\n        //this.processEntities();\r\n      }\r\n    );\r\n  };\r\n\r\n  ceaseFire = () => {\r\n    Helpers.resetGivenFieldsOnACollection(EntitiesService.entities, \"isShooting\");\r\n    this.processInterface();\r\n  };\r\n}\r\n","export * from \"./GameActionsService\";\r\n","import React from \"react\";\r\n\r\ninterface BloodProps {\r\n  bloodAmount: number; // receives amount of blood ONLY\r\n}\r\n\r\n/**\r\n * @description\r\n * Visualises blood by adding red background\r\n * and a little number in the corner.\r\n *\r\n * @param bloodAmount - number representing the amount of blood.\r\n */\r\nclass Blood extends React.PureComponent<BloodProps> {\r\n  render() {\r\n    console.log('BLOOD', this.props);\r\n    let { bloodAmount } = this.props;\r\n\r\n    let bloodNumbers = [];\r\n    let i = bloodAmount;\r\n\r\n    while(i--) {\r\n      bloodNumbers.push(\r\n        <span style={{\r\n          position: 'absolute',\r\n          left: `${Math.random() * 90}%`,\r\n          top: `${Math.random() * 90 -15}%`,\r\n        }}>o</span>\r\n      );\r\n    }\r\n\r\n    return (\r\n      <div\r\n        className=\"square__blood\"\r\n        style={{\r\n          background: `rgba(255, 0, 0, ${(bloodAmount / 50).toFixed(2)})`,\r\n          position: 'relative'\r\n        }}\r\n      >\r\n        {bloodNumbers}\r\n        {bloodAmount}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Blood;\r\n","import React from \"react\";\r\nimport { Entity, Item } from \"../../services\";\r\n\r\ninterface ItemsProps {\r\n  items: Item[];\r\n  itemsNumber: number; // here to trigger update when list length changes\r\n}\r\n// FIXME: I have a strange feeling this doesn't update when contents of items list change but not the number of elements\r\n/**\r\n * @description\r\n * Displays icons of items on the square, as well as little number in the corner.\r\n * @param itemsNumber - number of items on the square\r\n * @param items - array of items on the square\r\n */\r\nclass Items extends React.PureComponent<ItemsProps> {\r\n  itemsIcons = [];\r\n\r\n  render() {\r\n    let { items, itemsNumber } = this.props;\r\n\r\n    if (!items) return null;\r\n\r\n    items.forEach((item) => {\r\n      let entity = item as Entity;\r\n      if (entity.icon) {\r\n        this.itemsIcons.push(<div className=\"square__item-icon\">{entity.icon}</div>);\r\n      }\r\n    });\r\n\r\n    return (\r\n      <div className=\"square__items\">\r\n        <div className=\"square__items-icons\">{this.itemsIcons}</div>\r\n        <div className=\"square__items-number\">{itemsNumber}</div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Items;\r\n","import React, { ReactElement } from \"react\";\r\n// services\r\nimport { Item } from \"../../services\";\r\n// components\r\nimport Blood from \"../Square/Blood\";\r\nimport Items from \"../Square/Items\";\r\n// others\r\nimport \"./Square.scss\";\r\n\r\n// TODO: This should really take less props\r\ninterface SquareProps {\r\n  squareId: number;\r\n  className?: string;\r\n  onClick: (squareIndex: number) => void;\r\n  blood: number;\r\n  items: Item[]; // collection of objects\r\n  itemsNumber: number; // here to trigger update when list length changes\r\n}\r\n\r\n/**\r\n * @description Displays a square with blood and items on it.\r\n * @param squareId - unique numerical id\r\n * @param className - string with CSS clasess\r\n * @param onClick - callback to call when square is clicked\r\n * @param blood - amount of blood\r\n * @param items - array of items\r\n * @param itemsNumber - numberof items\r\n */\r\nclass SquareComponent extends React.PureComponent<SquareProps> {\r\n  onClick = () => {\r\n    this.props.onClick(this.props.squareId);\r\n  };\r\n\r\n  render() {\r\n    // console.log(\"Render Square\", this.props.squareId);\r\n    // TODO: Extract into separate component\r\n    function cuboid(classPrefix:string):ReactElement {\r\n      let i = 6;\r\n      let cuboidFaces: ReactElement[] = [];\r\n\r\n      while(i--){\r\n        cuboidFaces.push(<div key={i} className={`${classPrefix}__cuboid-face`}></div>);\r\n      }\r\n\r\n      return <div className={`${classPrefix}__cuboid`}>\r\n        {cuboidFaces}\r\n      </div>\r\n    }\r\n\r\n    return (\r\n      <button className={this.props.className} onClick={this.onClick}>\r\n        <Blood bloodAmount={this.props.blood} />\r\n        <Items items={this.props.items} itemsNumber={this.props.itemsNumber} />\r\n        <div className=\"square__content\">&nbsp;</div>\r\n        {cuboid('square')}\r\n      </button>\r\n    );\r\n  }\r\n}\r\n\r\nexport default SquareComponent;\r\n","import React from \"react\";\r\nimport \"./HpBar.scss\";\r\n\r\ninterface HpBarProps {\r\n    current: number;\r\n    max: number;\r\n    color: string;\r\n}\r\n\r\nexport class HpBar extends React.Component<HpBarProps> {\r\n\r\n    render() {\r\n        let percentage = ~~((this.props.current * 100) / this.props.max);\r\n        let progressStyle = {\r\n            width: `${percentage}%`,\r\n            backgroundColor: this.props.color\r\n        };\r\n        return(\r\n            <div className=\"hpbar\">\r\n                <div className=\"hpbar__indicator\" style={progressStyle}>\r\n\r\n                </div>\r\n                <span className=\"hpbar__text\">\r\n                        {this.props.current}\r\n                </span>\r\n            </div>\r\n        );\r\n    }\r\n}","import * as Helpers from \"../../helpers\";\r\nimport React, { ReactElement } from \"react\";\r\n\r\nexport function ShootingVisualization(props): ReactElement {\r\n  const DISTANCE_BETWEEN_TILES = 54;\r\n  let { entity } = props;\r\n\r\n  let calcNewAangle = Helpers.calculateAngle;\r\n  let targetCoords = entity.targetPosition;\r\n  let projectileNumber = 5;\r\n  let projectiles = [];\r\n  let localId = `Entity${entity.icon}`;\r\n  let customStyle = \"\";\r\n\r\n  if (\r\n    targetCoords &&\r\n    entity.position &&\r\n    entity.hasWeapon &&\r\n    entity.isShooting &&\r\n    (entity.targetPosition.x !== entity.position.x || entity.targetPosition.y !== entity.position.y)\r\n  ) {\r\n    if (targetCoords) {\r\n      let distanceToTargetXInUnits = (targetCoords.x - entity.position.x);\r\n      let distanceToTargetYInUnits = (targetCoords.y - entity.position.y);\r\n\r\n      let actualDistanceInUnits = Helpers.calculateDistance(distanceToTargetXInUnits, distanceToTargetYInUnits);\r\n      let weaponType = entity && entity.equipment && entity.equipment.hands && entity.equipment.hands.type;\r\n      let angle = calcNewAangle(distanceToTargetXInUnits, distanceToTargetYInUnits);\r\n\r\n      if (weaponType === \"lazer\") {\r\n        // TODO: perhaps call to `visualizeShooting(from,to,weaponType)`\r\n        let className = `projectile${localId}_beam`;\r\n        let projectile = \"\";\r\n        const distanceWhereBeamBegins = 20;//in pixels\r\n        //actualDistance = actualDistance - distanceWhereBeamBegins;\r\n        // do above within template\r\n        customStyle = `\r\n          @keyframes pulsing${localId} {\r\n            0%  {opacity: 0.1;}\r\n            100%  {opacity: 1;}\r\n          }\r\n\r\n          @keyframes elongating${localId} {\r\n            0%  { width: calc(${actualDistanceInUnits}em + ${actualDistanceInUnits} * 4px - 20px); }\r\n            100%  {width: calc(${actualDistanceInUnits}em + ${actualDistanceInUnits} * 4px - 20px); }\r\n          }\r\n\r\n          @keyframes swiping${localId} {\r\n            0%  {transform: rotate(${angle + 90 -1}deg) translateX(${distanceWhereBeamBegins}px);}\r\n            50%  {transform: rotate(${angle + 90 + 1}deg) translateX(${distanceWhereBeamBegins}px);}\r\n            100%  {transform: rotate(${angle + 90 - 1}deg) translateX(${distanceWhereBeamBegins}px);}\r\n          }\r\n\r\n          .${className} {\r\n            width: ${actualDistanceInUnits}em;\r\n            height: 3px;\r\n            border-radius: 5px;\r\n            background: #F00;\r\n            position: absolute;\r\n            top: 0.5em;\r\n            left: 0.5em;\r\n            transform: rotate(${angle + 90}deg);/* overriden by swiping keyframes */\r\n            transform-origin: left 0px;\r\n            animation: pulsing${localId} 0.1s ease infinite,\r\n            elongating${localId} 0.7s ease alternate infinite,\r\n            swiping${localId} 1s ease alternate infinite;\r\n            box-shadow: 0 0 5px 5px white;\r\n            z-index: 10;\r\n          }\r\n          `;\r\n        projectiles.push(\r\n          <div key={className} className={className}>\r\n            {projectile}\r\n          </div>\r\n        );\r\n      } else {\r\n        customStyle = `\r\n          @keyframes shooting${localId} {\r\n            0%   {transform: translate(0,0) rotate(${angle}deg) scaleY(0.3)}\r\n            100% {transform: translate(\r\n              ${36 * (targetCoords.x - entity.position.x)}px,\r\n              ${36 * (targetCoords.y - entity.position.y)}px\r\n            ) rotate(${angle}deg) scaleY(2)}\r\n          }\r\n          `;\r\n\r\n        while (projectileNumber--) {\r\n          customStyle += `\r\n          .projectile${localId}_${projectileNumber} {\r\n            transform: rotate(${angle}deg);\r\n            animation: shooting${localId} 0.8s linear infinite;\r\n            animation-delay: ${projectileNumber - 1 * 0.3}s;\r\n          }`;\r\n        }\r\n        let projectile = entity.isShooting ? \"|\" : \"\";\r\n\r\n        projectileNumber = 3;\r\n\r\n        while (projectileNumber--) {\r\n          let className = `projectile projectile${localId}_${projectileNumber}`;\r\n          projectiles.push(\r\n            <div key={className} className={className}>\r\n              {projectile}\r\n            </div>\r\n          );\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return (\r\n    <div className=\"shooting-visualization\">\r\n      <style>{customStyle}</style>\r\n      {projectiles}\r\n    </div>\r\n  );\r\n}\r\n","import React from \"react\";\r\nimport { SquaresService } from \"../../services\";\r\nimport { Entity } from \"../../services/EntitiesService\";\r\nimport { HpBar } from \"../HpBar\";\r\nimport { ShootingVisualization } from \"../ShootingVisualization\";\r\nimport * as Helpers from \"../../helpers\";\r\nimport \"./EntityPawn.scss\";\r\n\r\ninterface EntityPawnProps {\r\n  entity: Entity;\r\n}\r\n\r\nexport default class EntityPawn extends React.Component<EntityPawnProps> {\r\n  randomTime = `${(Math.random() + 0.5).toFixed(2)}s`;\r\n\r\n  render() {\r\n    let { entity } = this.props;\r\n    let square = SquaresService.getSquare(entity.position.x, entity.position.y);\r\n\r\n    let classNameBase = \"entity-pawn__icon\";\r\n    let className = `${classNameBase}`;\r\n    let classessFromFlags = Helpers.turnFlagsIntoClasses(entity, classNameBase);\r\n    classessFromFlags += Helpers.turnFlagsIntoClasses(square, classNameBase);\r\n    className += ` ${classessFromFlags} `;\r\n    let fof = entity.isFriendly ? 'friendly' : 'hostile';\r\n    let color = entity.isFriendly ? 'green' : 'red';\r\n    let zIndex = entity.isShooting ? 5 : 1;\r\n    let animationBreathing = entity.isBreathing ? `breathing ${this.randomTime} alternate infinite linear` : \"none\";\r\n\r\n    let boardPadding = 10;\r\n    let squareMargin = 2;\r\n    return (\r\n      <div\r\n        className=\"entity-pawn\"\r\n        key={entity.name}\r\n        style={{\r\n          left: `calc(${boardPadding + 3}px + ${entity.position.x * squareMargin * 2}px + ${entity.position.x}em)`,\r\n          top: `calc(${boardPadding + 3}px + ${entity.position.y * squareMargin * 2}px + ${entity.position.y}em)`,\r\n          zIndex: zIndex,\r\n        }}\r\n      >\r\n        <div\r\n          className={`entity-pawn__health-display ` + fof}\r\n        >\r\n\r\n          <HpBar\r\n            current={entity.hp}\r\n            max={entity.maxHp}\r\n            color={color}\r\n          />\r\n        </div>\r\n\r\n        <div\r\n          className={className}\r\n          style={{\r\n            animation: animationBreathing,\r\n          }}\r\n        >\r\n          {entity.icon}\r\n        </div>\r\n        <ShootingVisualization entity={entity} />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { ReactElement } from \"react\";\r\n\r\nimport SquareComponent from \"../Square\";\r\nimport EntityPawnComponent from \"../EntityPawn\";\r\nimport * as Helpers from \"../../helpers\";\r\nimport { Entity } from \"../../services/EntitiesService\";\r\nimport { Square } from \"../../services/SquaresService\";\r\n\r\nimport styles from \"./Board.module.scss\";\r\n\r\ninterface BoardProps {\r\n  onClick(i: number): void;\r\n  squares: Square[]; // updated every tick\r\n  entities: Entity[]; // updated every tick\r\n  size: number;\r\n  isRotated: boolean;\r\n  style: any;\r\n}\r\n/**\r\n * @description Board component renders Squares and EntityPawns\r\n */\r\nexport default class Board extends React.Component<BoardProps> {\r\n  handleClick = (i: number) => {\r\n    console.log(\"Handles Click on Board\", i);\r\n    this.props.onClick(i);\r\n  };\r\n\r\n  renderSquare(i: number, rowId: number, colId: number) {\r\n    let square = this.props.squares[i];\r\n\r\n    return (\r\n      <SquareComponent // is a pureComponent\r\n        key={`r${rowId}_c${i}`}\r\n        squareId={i}\r\n        className={Helpers.getCssClassesForAGivenSquare(square)}\r\n        onClick={this.handleClick}\r\n        blood={square && square.blood} // number\r\n        items={square && square.items} // list of objects\r\n        itemsNumber={square && square.items && square.items.length}\r\n      ></SquareComponent>\r\n    );\r\n  }\r\n\r\n  EntityPawns = (): ReactElement[] => this.props.entities.map((entity) => <EntityPawnComponent key={entity.name} entity={entity} />);\r\n\r\n  BoardSquares = () => {\r\n    let cellId: number = 0;\r\n    let rowId: number = 0;\r\n    let colId: number;\r\n\r\n    let rowsOfSquares = Array(this.props.size)\r\n      .fill(null)\r\n      .map((row, number) => {\r\n        colId = 0;\r\n        let cells = Array(this.props.size)\r\n          .fill(null)\r\n          .map((cell, number) => {\r\n            return this.renderSquare(cellId++, rowId, colId++);\r\n          });\r\n        return (\r\n          <div key={rowId++} className={styles[\"board__row\"]}>\r\n            {cells}\r\n          </div>\r\n        );\r\n      });\r\n\r\n    return rowsOfSquares;\r\n  }; // Board Squares\r\n\r\n  render() {\r\n    let className: string = styles.board;\r\n    if (this.props.isRotated) {\r\n      className += ` ${styles[\"board--rotated\"]} board--rotated`;\r\n    }\r\n    return (\r\n      <div className={className} style={this.props.style}>\r\n        {this.BoardSquares()}\r\n        {this.EntityPawns()}\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React from \"react\";\r\nimport \"./LinearDisplay.scss\";\r\n\r\ninterface LinearDisplayProps {\r\n  className?: string;\r\n  current: number;\r\n  max: number;\r\n  title?: string;\r\n  label?: string;\r\n}\r\n\r\nexport function LinearDisplay(props: LinearDisplayProps) {\r\n  let className = `linear-display ${props.className || \"\"}`;\r\n  let percentage = ~~((props.current * 100) / props.max);\r\n  let overload = percentage > 100;\r\n  if (overload) {\r\n    percentage = 100;\r\n    className += \" linear-display--overloaded\";\r\n  }\r\n\r\n  let progressStyle = {\r\n    width: `${percentage}%`,\r\n  };\r\n  let title = props.title || `${props.current}/${props.max}`;\r\n\r\n  let amount = props.current;\r\n\r\n  let divider = 1;\r\n  if (props.max >= 40 && props.max < 100) {\r\n    divider = 5;\r\n  } else if (props.max >= 100) {\r\n    divider = 10;\r\n  }\r\n\r\n  amount = amount / divider;\r\n\r\n  let gridSize = 100 / amount;\r\n\r\n  let color = `rgba(200,200,200,0.4)`;\r\n  color = `black`;\r\n  let progressGridStyle = {\r\n    backgroundSize: `${gridSize}% 100%`,\r\n    backgroundImage: `\r\n      linear-gradient(to left, ${color} 1px, transparent 1px)\r\n    `,\r\n  };\r\n\r\n  Object.assign(progressStyle, progressGridStyle);\r\n\r\n  return (\r\n    <div className={className}>\r\n      <div className=\"linear-display__label\">{props.label}:&nbsp;</div>\r\n      <div className=\"linear-display__bar-container\" title={title}>\r\n        <div className=\"linear-display__bar-progress\" style={progressStyle}>\r\n          <span className=\"linear-display__bar-progress-text\">\r\n            {props.current}\r\n            {overload ? \"/\" + props.max : \"\"}&nbsp;\r\n          </span>\r\n        </div>\r\n      </div>\r\n      <div>&nbsp;</div>\r\n    </div>\r\n  );\r\n}\r\n","import React from \"react\";\r\nimport { Item, RangedWeapon } from \"../../services\";\r\nimport { LinearDisplay } from \"../LinearDisplay\";\r\n\r\ninterface InventoryItemProps {\r\n  item: Item;\r\n  onDrop(itemName: string);\r\n  onReload(itemName: string);\r\n  onClick(itemName: string);\r\n  processInterface: Function;\r\n}\r\n\r\nexport function InventoryItem(props: InventoryItemProps) {\r\n  let { item } = props;\r\n  let reloadButton;\r\n  let dropButton;\r\n  let ammoCounter;\r\n\r\n  if (props.onDrop) {\r\n    dropButton = (\r\n      <button\r\n        className=\"inventory-list__drop-button\"\r\n        onClick={() => {\r\n          props.onDrop(item.name);\r\n        }}\r\n      >\r\n        Drop\r\n      </button>\r\n    );\r\n  }\r\n\r\n  if (item instanceof RangedWeapon) {\r\n    let weapon = item as RangedWeapon;\r\n\r\n    if (weapon.reload) {\r\n      // has reload capability\r\n      let className = \" inventory-list__reload-button \";\r\n\r\n      if (weapon.rounds === 0 || weapon.rounds === \"empty\") {\r\n        className += \" inventory-list__reload-button--empty \";\r\n      } else if (weapon.rounds < weapon.maxRounds) {\r\n        className += \" inventory-list__reload-button--partial \";\r\n      }\r\n      reloadButton = (\r\n        <button\r\n          className={className}\r\n          onClick={() => {\r\n            weapon.reload();\r\n            props.onReload && props.onReload(item.name);\r\n            props.processInterface();\r\n          }}\r\n        >\r\n          Reload\r\n        </button>\r\n      );\r\n    } else {\r\n      reloadButton = null;\r\n    }\r\n\r\n    ammoCounter = weapon.reload ? (\r\n      <LinearDisplay label=\"Rounds\" current={weapon.rounds} max={weapon.maxRounds} />\r\n    ) : null;\r\n  }\r\n\r\n  return (\r\n    <div key={item.name}>\r\n      <div onClick={() => props.onClick(item.name)} key={item.name} className=\"inventory-list__item\">\r\n        <span>{item.name}</span>\r\n        <div>{ammoCounter}</div>\r\n      </div>\r\n      {reloadButton}\r\n      {dropButton}\r\n    </div>\r\n  );\r\n}\r\n","import React from \"react\";\r\nimport \"./InventoryList.scss\";\r\nimport { Item } from \"../../services\";\r\nimport { InventoryItem } from \"../InventoryItem\";\r\n\r\ninterface InventoryListProps {\r\n  className?: string;\r\n  label: string;\r\n  title: string;\r\n  onClick(itemName: string);\r\n  onDrop(itemName: string);\r\n  onReload(itemName: string);\r\n  inventory: Item[]; //\r\n  processInterface: Function;\r\n}\r\n\r\nexport function InventoryList(props: InventoryListProps) {\r\n  const className = `inventory-list ${props.className || \"\"}`;\r\n\r\n  if (!props.inventory) {\r\n    return null;\r\n  }\r\n\r\n  const inventoryItems = props.inventory.map((item) => (\r\n    <InventoryItem\r\n      key={`i${item.name}`}\r\n      item={item}\r\n      onClick={props.onClick}\r\n      onDrop={props.onDrop}\r\n      onReload={props.onReload}\r\n      processInterface={props.processInterface}\r\n    />\r\n  ));\r\n\r\n  return (\r\n    <div className={className}>\r\n      <div className=\"inventory-list__label\">\r\n        {props.label}\r\n        :&nbsp;\r\n      </div>\r\n      <div className=\"inventory-list__items\" title={props.title}>\r\n        {inventoryItems}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n","import React from \"react\";\r\nimport { LinearDisplay } from \"../LinearDisplay\";\r\nimport { InventoryList } from \"../InventoryList\";\r\nimport \"./EntityCard.scss\";\r\nimport { Entity, Item } from \"../../services\";\r\n\r\ninterface EntityCardProps {\r\n  entity: Entity;\r\n  onInventoryClick?(entity: Entity, itemName: string);\r\n  processInterface?: Function;\r\n}\r\n\r\nexport class EntityCard extends React.Component<EntityCardProps> {\r\n  renderCount = 0;\r\n  handleInventoryClick = (itemName: string): void => {\r\n    this.props.onInventoryClick(this.props.entity, itemName);\r\n  };\r\n\r\n  onDrop = (itemName: string) => {\r\n    let { entity } = this.props;\r\n    if (entity.equipment.hands && entity.equipment.hands.name === itemName) {\r\n      entity.unEquipFromHands();\r\n      entity.isShooting = false;\r\n    }\r\n    let item: Item = entity.takeFromInventory(itemName);\r\n    entity.square.addItem(item);\r\n    this.props.processInterface();\r\n  };\r\n\r\n  onReload = (itemName: string) => {\r\n    let { entity } = this.props;\r\n    if (entity.equipment.hands && entity.equipment.hands.name === itemName) {\r\n      entity.isShooting = false;\r\n    }\r\n    this.props.processInterface();\r\n  };\r\n\r\n  render() {\r\n    let { entity } = this.props;\r\n    if (!entity) return null;\r\n    // FIXME: Below should be separated into several sub-components\r\n    // Each sub-component should receive flat data (position, hp, ...)\r\n\r\n    let className = \"entity-card\";\r\n    if (entity.active) {\r\n      className += \" entity-card--active\";\r\n    }\r\n\r\n    if (entity.isFriendly) {\r\n      className += \" entity-card--friendly\";\r\n    }\r\n\r\n    if (entity.isDead) {\r\n      className += \" entity-card--dead\";\r\n    }\r\n\r\n    let inHands = entity.equipment && entity.equipment.hands;\r\n    let inHandsArray = inHands && [inHands];\r\n\r\n    return (\r\n      <div className={className}>\r\n        <div>\r\n          <div className=\"entity-card__position\" title=\"Position\">\r\n            <span>\r\n              {\" \"}\r\n              {entity.position.x} {entity.position.y}{\" \"}\r\n            </span>\r\n          </div>\r\n\r\n          <div className=\"entity-card__portrait\">{entity.icon}</div>\r\n        </div>\r\n        <strong title=\"Name\">{entity.name}</strong>\r\n        <br />\r\n        <div\r\n          style={{\r\n            clear: \"both\",\r\n            display: \"inline-block\",\r\n            textAlign: \"right\",\r\n          }}\r\n        >\r\n          <LinearDisplay label=\"HP\" current={entity.hp} max={entity.maxHp} />\r\n          <br />\r\n        </div>\r\n        <InventoryList\r\n          label=\"Equipped\"\r\n          title=\"In hands\"\r\n          onClick={this.handleInventoryClick}\r\n          onDrop={this.onDrop}\r\n          onReload={this.onReload}\r\n          inventory={inHandsArray}\r\n          processInterface={() => this.props.processInterface()}\r\n        />\r\n        <InventoryList\r\n          label=\"Inventory\"\r\n          title=\"In backpack\"\r\n          onClick={this.handleInventoryClick}\r\n          onDrop={this.onDrop}\r\n          onReload={this.onReload}\r\n          inventory={entity.inventory}\r\n          processInterface={() => this.props.processInterface()}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","export const structures = {\r\n  box: {\r\n    name: \"box\",\r\n    icon: \"\",\r\n    hp: 50,\r\n    maxHp: 70,\r\n    isBreathing: false,\r\n    position: { x: 4, y: 5 },\r\n  },\r\n  redBarrel: {\r\n    name: \"redBarrel\",\r\n    icon: \"\",\r\n    hp: 50,\r\n    maxHp: 70,\r\n    isBreathing: false,\r\n    position: { x: 4, y: 5 },\r\n  },\r\n};\r\n","import React from \"react\";\r\n// services\r\nimport { SquaresService } from \"../../services\";\r\nimport { Entity, Square, Position, Item } from \"../../services\";\r\n// components\r\nimport { EntityCard } from \"../EntityCard\";\r\nimport { InventoryList } from \"../InventoryList\";\r\n// others\r\nimport { structures } from \"../../resources\";\r\nimport * as Helpers from \"../../helpers\";\r\nimport GameStyles from \"./Game.module.scss\";\r\n\r\ninterface TargetedSquareInfoProps {\r\n  className: string;\r\n  squareNumber: number;\r\n  squares: Square[];\r\n  selected: Entity;\r\n  targeted: Square;\r\n  onInventoryClick(entity: Entity, itemName: string): void;\r\n  processInterface: Function;\r\n}\r\n\r\n// TODO: Refactor, does it really need all this logic.\r\nexport default class TargetedSquareInfo extends React.Component<TargetedSquareInfoProps> {\r\n  boxSerialNumber: number = 0;\r\n\r\n  onItemClick = (itemName: string): void => {\r\n    let { selected, targeted, squareNumber } = this.props;\r\n    let targetedSquarePosition = SquaresService.targetSquarePosition(squareNumber);\r\n    if (selected && targeted &&\r\n      selected.position.x == targetedSquarePosition.x &&\r\n      selected.position.y == targetedSquarePosition.y\r\n      ) {\r\n      let item = targeted.takeFromInventory(itemName);\r\n      selected.addToInventory(item);\r\n    }\r\n    this.props.processInterface();\r\n  };\r\n\r\n  onMoveClick(selected: Entity, targetedSquarePosition: Position): void {\r\n    let targetedSquare: Square = SquaresService.getSquare(targetedSquarePosition.x, targetedSquarePosition.y);\r\n    selected.setMoveDestinationPosition(targetedSquarePosition);\r\n    targetedSquare.isChosenDestination = true;\r\n    this.props.processInterface();\r\n  }\r\n\r\n  onAttackClick(selected: Entity, targetedSquarePosition: Position): void {\r\n    selected.attackPosition(targetedSquarePosition);\r\n    this.props.processInterface();\r\n  }\r\n\r\n  onAddStructureClick(targetedSquarePosition: Position, structureType: string): void {\r\n    let box = Object.assign({}, structures[structureType]);\r\n    let targetPosition = Object.assign({}, targetedSquarePosition);\r\n    box.position = targetPosition;\r\n    box.name += this.boxSerialNumber++;\r\n    let newStructure = new Entity(box);\r\n    let square = SquaresService.getSquare(targetedSquarePosition.x, targetedSquarePosition.y);\r\n    square.entity = newStructure;\r\n    square.addToInventory(newStructure as Item); // TODO: FIXME: Stop forcing types, make a new list for scenery items.\r\n    //EntitiesService.entities.push(newBox);\r\n    this.props.processInterface();\r\n  }\r\n\r\n  render() {\r\n    let { targeted, selected, squareNumber } = this.props;\r\n\r\n    if (!targeted) {\r\n      return null;\r\n    }\r\n\r\n    let targetedSquarePosition = SquaresService.targetSquarePosition(squareNumber);\r\n\r\n    let entityInfo;\r\n    let distanceInfo;\r\n    let positionInfo;\r\n    let bloodInfo;\r\n    let availableActions = [];\r\n    let items;\r\n\r\n    let editorButtons = (\r\n      <div>\r\n        <button onClick={() => this.onAddStructureClick(targetedSquarePosition, \"box\")} className={GameStyles.button}>\r\n          Add box\r\n        </button>\r\n        <button\r\n          onClick={() => this.onAddStructureClick(targetedSquarePosition, \"redBarrel\")}\r\n          className={GameStyles.button}\r\n        >\r\n          Add barrel\r\n        </button>\r\n      </div>\r\n    );\r\n\r\n    if (targeted.entity && !Helpers.isSelectedTargeted(selected, targeted)) {\r\n      entityInfo = (\r\n        <EntityCard\r\n          onInventoryClick={this.props.onInventoryClick}\r\n          entity={targeted.entity}\r\n          processInterface={() => this.props.processInterface()}\r\n        />\r\n      );\r\n    }\r\n\r\n    if (targeted.items) {\r\n      items = (\r\n        <InventoryList\r\n          label=\"Items in this location\"\r\n          title=\"On the floor\"\r\n          onClick={this.onItemClick}\r\n          onDrop={null}\r\n          onReload={null}\r\n          inventory={targeted.items}\r\n          processInterface={() => this.props.processInterface()}\r\n        />\r\n      );\r\n    }\r\n\r\n    if (selected) {\r\n      let distanceToSelected = Helpers.calculateDistance(\r\n        targetedSquarePosition.x - selected.position.x,\r\n        targetedSquarePosition.y - selected.position.y\r\n      );\r\n\r\n      distanceInfo = <li>Distance to selected: {distanceToSelected.toFixed(2)}</li>;\r\n\r\n      if (distanceToSelected !== 0) {\r\n        if (targeted.isAvailableDestination) {\r\n          availableActions[0] = (\r\n            <button key=\"move\" onClick={() => this.onMoveClick(selected, targetedSquarePosition)} className={GameStyles.button}>\r\n              Move\r\n            </button>\r\n          );\r\n        }\r\n        if (targeted.entity) {\r\n          availableActions[1] = (\r\n            <button key=\"attack\" onClick={() => this.onAttackClick(selected, targetedSquarePosition)} className={GameStyles.button}>\r\n              Attack\r\n            </button>\r\n          );\r\n        }\r\n      }\r\n    }\r\n\r\n    if (targetedSquarePosition) {\r\n      positionInfo = (\r\n        <li>\r\n          Position: [ {targetedSquarePosition.x}, {targetedSquarePosition.y} ]{\" \"}\r\n        </li>\r\n      );\r\n    }\r\n\r\n    if (targeted.blood) {\r\n      bloodInfo = <li>Blood amount: {targeted.blood}</li>;\r\n    }\r\n\r\n    return (\r\n      <div className={this.props.className}>\r\n        <strong className={GameStyles.targeted__label}>Target square Info</strong>\r\n        <div>{entityInfo}</div>\r\n        <div>{availableActions}</div>\r\n        <ul>\r\n          {positionInfo}\r\n          {distanceInfo}\r\n          {bloodInfo}\r\n          {items}\r\n          {editorButtons}\r\n        </ul>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React, { ReactElement } from \"react\";\r\n// services\r\nimport { Entity } from \"../../services\";\r\n// components\r\nimport { EntityCard } from \"../EntityCard\";\r\n// others\r\nimport GameStyles from \"./Game.module.scss\";\r\n\r\ninterface SelectedEntityInfoProperties {\r\n  selected: Entity;\r\n  onInventoryClick(entity: Entity, itemName: string): void;\r\n  handleDeselectAllEntities: () => void;\r\n  processInterface: Function;\r\n}\r\n\r\n// TODO: Change this into HOC, as it doesn't really need half of it's props for itself\r\nexport default class SelectedEntityInfo extends React.Component<SelectedEntityInfoProperties> {\r\n  render(): ReactElement {\r\n    if (!this.props.selected) {\r\n      return null;\r\n    }\r\n\r\n    return (\r\n      <div className={GameStyles.selected}>\r\n        <strong className={GameStyles.selected__label}>Selected entity </strong>\r\n        <div>\r\n          <EntityCard\r\n            onInventoryClick={this.props.onInventoryClick}\r\n            entity={this.props.selected}\r\n            processInterface={() => this.props.processInterface()}\r\n          />\r\n        </div>\r\n        <button onClick={this.props.handleDeselectAllEntities} className={GameStyles.button}>\r\n          {\" \"}\r\n          Deselect\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n","import React from \"react\";\r\n// services\r\nimport \"./MessageBox.scss\";\r\nimport { MessageService } from \"../../services\";\r\n\r\nexport class MessageBox extends React.Component {\r\n  messages = MessageService.messages;\r\n  messageNumber;\r\n\r\n  shouldComponentUpdate() {\r\n    // don't update if there are no new messages since last render\r\n    return this.messages.length !== this.messageNumber;\r\n  }\r\n\r\n  renderMessage = (message: string, number: number) => {\r\n    return (\r\n      <li key={`msg${number}`}>\r\n        Message #[{number}]: {message}\r\n      </li>\r\n    );\r\n  };\r\n\r\n  render() {\r\n    if (!this.messages.length) return null;\r\n    let RenderedMessages = this.messages.map((message, number) => this.renderMessage(message, number));\r\n    // remember the number of messages rendered\r\n    this.messageNumber = this.messages.length;\r\n    return (\r\n      <ul className=\"messages\" id=\"messages\">\r\n        {RenderedMessages}\r\n      </ul>\r\n    );\r\n  }\r\n\r\n  scrollElement() {\r\n    window.requestAnimationFrame(() => {\r\n      var element = document.getElementById(\"messages\");\r\n      element.scrollTop = element.scrollHeight;\r\n    });\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    if (this.messages.length) this.scrollElement();\r\n  }\r\n}\r\n","import React from \"react\";\r\n//import * as dat from \"dat.gui\";\r\n\r\n// services\r\nimport { EntitiesService, SquaresService, GameModel, GameActionsClass, GameState } from \"../../services\";\r\n\r\n// components\r\nimport Board from \"../Board\";\r\nimport EntitiesList from \"../EntitiesList\";\r\nimport TargetedSquareInfo from \"./TargetedSquareInfo\";\r\nimport SelectedEntityInfo from \"./SelectedEntityInfo\";\r\nimport { MessageBox } from \"../MessageBox\";\r\n\r\n// others\r\nimport styles from \"./Game.module.scss\";\r\n\r\nlet GameActions = null;\r\n\r\n/** Game composes all the parts of the interface */\r\nexport class Game extends React.PureComponent<void, GameState> {\r\n  renderCounter: number = 0;\r\n  stepNumber: number = 0;\r\n  //dat;\r\n\r\n  constructor(props: void) {\r\n    super(props);\r\n\r\n    GameModel.loadBuiltInMap();\r\n    GameModel.loadPredefinedEntitities();\r\n    //this.dat = new dat.GUI();\r\n    this.state = {\r\n      entities: EntitiesService.entities,\r\n      squares: SquaresService.squares,\r\n      squareSize: 40,\r\n      selected: EntitiesService.findEntityById(\"Lazer Blady\"),\r\n      targeted: null,\r\n      targetedSquareNumber: null,\r\n      enemiesAlive: null,\r\n      arenaSize: 10,\r\n      autoLoop: true,\r\n      isBoardRotated: false,\r\n      isEditorOn: false,\r\n    };\r\n    this.state.selected.active = true;\r\n    GameActions = new GameActionsClass(this);\r\n  }\r\n\r\n  componentDidMount() {\r\n    GameActions.loop();\r\n  }\r\n\r\n  zoomIn() {\r\n    this.setState((prevState) => {\r\n      return { squareSize: prevState.squareSize + 5 };\r\n    });\r\n  }\r\n  zoomOut() {\r\n    this.setState((prevState) => {\r\n      return { squareSize: prevState.squareSize - 5 };\r\n    });\r\n  }\r\n  render() {\r\n    // console.log(\"Rendering Game. #\", this.renderCounter++);\r\n    return (\r\n      <div className={styles.game}>\r\n        <div className={styles.status}>\r\n          Enemies to kill: {this.state.enemiesAlive}<br></br>\r\n          {this.state.enemiesAlive ? '' : \" Great Job. YOU WON.\" }\r\n          {this.state.selected.isAlive ? '' : \" Damn. YOU DIED.\" }\r\n        </div>\r\n        <p>\r\n          L2P: Click friendly entity on the map, twice. Then click a target square to move, or target entity to attack.\r\n        </p>\r\n        <div className={styles.game__board}>\r\n          <Board\r\n            squares={this.state.squares}\r\n            entities={this.state.entities}\r\n            onClick={(i) => GameActions.handleClickV2(i)}\r\n            size={this.state.arenaSize}\r\n            isRotated={this.state.isBoardRotated}\r\n            style={{fontSize: `${this.state.squareSize}px`}}\r\n          />\r\n        </div>\r\n\r\n        <div className={styles.game__info}>\r\n          <div className={styles.actions}>\r\n            <button onClick={GameActions.toggleEditorMode} className={styles.button}>\r\n              Editor Mode\r\n            </button>\r\n            <button onClick={GameModel.saveMap} className={styles.button}>\r\n              Save Map\r\n            </button>\r\n            <button onClick={GameModel.loadMap} className={styles.button}>\r\n              Load Map\r\n            </button>\r\n            <button\r\n              onClick={() => {\r\n                GameActions.nuke(40);\r\n              }}\r\n              className={`${styles.button} ${styles[\"button-nuke\"]}`}\r\n            >\r\n              Nuke All\r\n            </button>\r\n            <button onClick={GameActions.ceaseFire} className={styles.button}>\r\n              Cease Fire\r\n            </button>\r\n\r\n            <button onClick={GameActions.toggleRotateBoard} className={styles.button}>\r\n              Rotate Board\r\n            </button>\r\n\r\n            <button onClick={() => this.zoomIn()} className={styles.button}>\r\n              Zoom In (+)\r\n            </button>\r\n            <button onClick={() => this.zoomOut()} className={styles.button}>\r\n              Zoom Out (-)\r\n            </button>\r\n\r\n            <button onClick={GameActions.nextTick} className={styles.button}>\r\n              Next Tick\r\n            </button>\r\n\r\n            <span className={styles[\"step-counter\"]}>Tick: {this.stepNumber}</span>\r\n\r\n            <label className={` ${styles.button} ${styles[\"auto-cycle\"]}`}>\r\n              <input type=\"checkbox\" checked={this.state.autoLoop} onChange={GameActions.switchAutoLoop} />\r\n              <span>Auto Cycle</span>\r\n            </label>\r\n          </div>\r\n          <div className={styles[\"interaction-container\"]}>\r\n            <SelectedEntityInfo\r\n              selected={this.state.selected}\r\n              handleDeselectAllEntities={GameActions.handleDeselectAllEntities}\r\n              onInventoryClick={GameActions.onInventoryClick}\r\n              processInterface={() => GameActions.processInterface()}\r\n            />\r\n\r\n            <TargetedSquareInfo\r\n              className={styles.targeted}\r\n              squareNumber={this.state.targetedSquareNumber}\r\n              squares={this.state.squares}\r\n              selected={this.state.selected}\r\n              targeted={this.state.targeted}\r\n              onInventoryClick={GameActions.onInventoryClick}\r\n              processInterface={() => GameActions.processInterface()}\r\n            />\r\n            <div></div>\r\n          </div>\r\n          <MessageBox />\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default Game;\r\n","import React from \"react\";\r\nimport \"./HudPanel.scss\";\r\n\r\ninterface HudPanelProps {\r\n  title: string;\r\n  children: JSX.Element;\r\n}\r\n\r\nexport class HudPanel extends React.Component<HudPanelProps> {\r\n\r\n    render() {\r\n        return <div className=\"hud-panel\">\r\n            <div className=\"hud-panel__title\">{this.props.title}</div>\r\n            <div className=\"hud-panel__content\">{this.props.children}</div>\r\n        </div>;\r\n    }\r\n}","import React from \"react\";\r\nimport { EntityCard } from \"../EntityCard\";\r\nimport \"./EntitiesList.scss\";\r\nimport { Entity } from \"../../services/EntitiesService\";\r\n\r\ninterface ListOfEntitiesProps {\r\n  entities: Entity[];\r\n  onInventoryClick: any;\r\n  processInterface: Function;\r\n}\r\n\r\nexport default class ListOfEntities extends React.Component<ListOfEntitiesProps> {\r\n  render() {\r\n    let entitiesFriendly = this.props.entities\r\n      .filter((entity) => entity.isFriendly)\r\n      .map((obj) => {\r\n        return (\r\n          <EntityCard\r\n            key={obj.name}\r\n            entity={obj}\r\n            onInventoryClick={this.props.onInventoryClick}\r\n            processInterface={() => this.props.processInterface()}\r\n          />\r\n        );\r\n      });\r\n\r\n    let entitiesUnfriendly = this.props.entities\r\n      .filter((entity) => !entity.isFriendly)\r\n      .map((obj) => {\r\n        return <EntityCard key={obj.name} entity={obj} processInterface={() => this.props.processInterface()} />;\r\n      });\r\n\r\n    return (\r\n      <>\r\n        <h4 className=\"entities-list__header\">List of Entities:</h4>\r\n        <div className=\"entities-list\">{entitiesFriendly}</div>\r\n        <div className=\"entities-list\">{entitiesUnfriendly}</div>\r\n      </>\r\n    );\r\n  }\r\n}\r\n","import React from \"react\";\r\n//import \"./Cell.scss\";\r\n\r\ninterface CellProps {\r\n}\r\n\r\ninterface CellState {\r\n}\r\n\r\nexport class Cell extends React.PureComponent<CellProps, CellState> {\r\n\r\n  state = {}\r\n\r\n  // constructor(props) {\r\n  //   super(props);\r\n  //   this.state = {\r\n  //   }\r\n  // }\r\n\r\n  render() {\r\n    //console.log(`Rendering [${this.props.children}]`);\r\n    return <div className=\"cell\">{this.props.children}</div>\r\n  }\r\n}","import React from \"react\";\r\nimport { Cell } from \"./Cell\";\r\nimport \"./Grid.scss\";\r\n\r\ninterface GridProps {\r\n  width: number;\r\n  height: number;\r\n  startAt: [number, number];\r\n}\r\n\r\ninterface GridState {\r\n  mapdrag: boolean,\r\n  scroll: {\r\n    x: number,\r\n    y: number,\r\n  }\r\n}\r\n\r\nexport class Grid extends React.Component<GridProps, GridState> {\r\n  gridReference;\r\n  scroll = {\r\n    x: 0,\r\n    y: 0,\r\n  }\r\n\r\n  mapdrag = false;\r\n\r\n  stateDriven = false;\r\n\r\n  constructor(props) {\r\n    super(props);\r\n    this.state = {\r\n      mapdrag: false,\r\n      scroll: {\r\n        x: 0,\r\n        y: 0,\r\n      }\r\n    }\r\n\r\n    this.gridReference = React.createRef();\r\n  }\r\n\r\n  scrollRelativeXY(deltaX: number, deltaY: number) {\r\n    this.scroll.x -= deltaX;\r\n    this.scroll.y -= deltaY;\r\n\r\n    if(this.scroll.x <= 0) {\r\n      this.scroll.x = 0;\r\n    }\r\n    if(this.scroll.y <= 0) {\r\n      this.scroll.y = 0;\r\n    }\r\n\r\n    if(this.stateDriven) {\r\n      this.setState({\r\n        scroll: {\r\n          x: this.scroll.x,\r\n          y: this.scroll.y,\r\n      }})\r\n    }\r\n    this.executeScroll();\r\n  }\r\n\r\n  renderGrid() {\r\n    let rows = [];\r\n    for(let y = 0; y <= this.props.height; y++) {\r\n      let sourceY = this.props.startAt[1] + y;\r\n      let currentRow = [];\r\n\r\n      for(let x = 0; x <= this.props.width; x++) {\r\n        let sourceX = this.props.startAt[0] + x;\r\n        let currentCell = <Cell key={`$key_${sourceX}_${sourceY}`}>{sourceX}, {sourceY}</Cell>\r\n        currentRow.push(currentCell);\r\n      }\r\n      rows.push(<div className=\"row\"  key={`$key_X_${sourceY}`}>{currentRow}</div>);\r\n    }\r\n    return <div\r\n      className=\"grid\"\r\n      ref={this.gridReference}\r\n      onMouseDown={(e) => this.onMouseDown(e)}\r\n      onMouseUp={(e) => this.onMouseUp(e)}\r\n      onMouseMove={(e) => this.handleMove(e)}\r\n      onContextMenu={(e)=>e.preventDefault()}\r\n      onDrag={(e)=>this.onMouseDrag(e)}\r\n      //onMouseOut={(e)=>this.onMouseOut(e)}\r\n    >{rows}</div>;\r\n  }\r\n\r\n  handleMove(e) {\r\n    if(!this.mapdrag) return;\r\n    this.scrollRelativeXY(e.movementX, e.movementY);\r\n  }\r\n\r\n  onMouseDrag(e){\r\n    console.log(e);\r\n  }\r\n\r\n  onMouseDown(e) {\r\n    console.log(e.button);\r\n    if(e.button === 2) {\r\n      this.mapdrag = true;\r\n    }\r\n    e.preventDefault();\r\n    console.log(this.mapdrag);\r\n  }\r\n\r\n  onMouseOut(e) {\r\n    console.log(\"MOUSE OUT\")\r\n    this.mapdrag = false;\r\n  }\r\n\r\n  startDragging(e){\r\n      this.mapdrag = true;\r\n  }\r\n\r\n  onMouseUp(e){\r\n    console.log(e.button);\r\n    if(e.button === 2) {\r\n      this.mapdrag = false;\r\n    }\r\n    e.preventDefault();\r\n    console.log(this.mapdrag);\r\n  }\r\n\r\n  onChangeScrollX(event) {\r\n    console.log(event.target.value);\r\n    this.scroll.x = event.target.value;\r\n    this.executeScroll();\r\n  }\r\n  onChangeScrollY(event) {\r\n    console.log(event.target.value)\r\n    this.scroll.y = event.target.value;\r\n    this.executeScroll();\r\n  }\r\n\r\n  executeScroll() {\r\n    this.gridReference.current.scroll({\r\n      top: this.scroll.y,\r\n      left: this.scroll.x,\r\n    });\r\n  }\r\n\r\n  switchStateDriven(e) {\r\n    console.log(e.target.checked);\r\n    this.stateDriven = e.target.checked;\r\n  }\r\n\r\n  render() {\r\n    return <div className=\"grid-container\">\r\n      <pre className=\"gridDebugData\">\r\n        Width: {this.props.width}<br/>\r\n        Height: {this.props.height}<br/>\r\n        StartAt: {this.props.startAt[0]}, {this.props.startAt[1]}<br/>\r\n        ScrollX: <input onChange={(e) => this.onChangeScrollX(e)}></input><br/>\r\n        ScrollY: <input onChange={(e) => this.onChangeScrollY(e)}></input><br/>\r\n        StateDriven: <input type=\"checkbox\" onChange={(e)=>this.switchStateDriven(e)}></input><br/>\r\n\r\n        State mapdrag: {this.state.mapdrag}<br/>\r\n        State scrollX: {this.state.scroll.x}<br/>\r\n        State scrollY: {this.state.scroll.y}<br/>\r\n      </pre>\r\n      {this.renderGrid()}\r\n    </div>;\r\n  }\r\n}","import React from \"react\";\r\nimport \"./Controls.scss\";\r\n\r\ninterface ControlsProps {\r\n    keys: string[],\r\n    onKeyPress: Function,\r\n}\r\n\r\ninterface ControlsState {\r\n    w: boolean,\r\n    s: boolean,\r\n    a: boolean,\r\n    d: boolean,\r\n}\r\n\r\nexport class Controls extends React.Component<ControlsProps, ControlsState> {\r\n    constructor(props) {\r\n        super(props);\r\n        this.state = {\r\n            w: false,\r\n            s: false,\r\n            a: false,\r\n            d: false,\r\n        }\r\n    }\r\n\r\n    componentDidMount(){\r\n        document.addEventListener(\"keydown\", (e) => this.onKeyDown(e), false);\r\n        document.addEventListener(\"keyup\", (e) => this.onKeyUp(e), false);\r\n    }\r\n\r\n    onKeyDown(event) {\r\n        console.log(event)\r\n        switch(event.keyCode) {\r\n            case 87: // W\r\n                this.setState({w: true});\r\n                this.props.onKeyPress('w');\r\n                break;\r\n            case 83: // S\r\n                this.setState({s: true});\r\n                this.props.onKeyPress('s');\r\n                break;\r\n            case 65: // A\r\n                this.setState({a: true});\r\n                this.props.onKeyPress('a');\r\n                break;\r\n            case 68: // D\r\n                this.setState({d: true});\r\n                this.props.onKeyPress('d');\r\n                break;\r\n        }\r\n    }\r\n\r\n    onKeyUp(event) {\r\n        console.log(event)\r\n        switch(event.keyCode) {\r\n            case 87: // W\r\n                this.setState({w: false});\r\n                break;\r\n            case 83: // S\r\n                this.setState({s: false});\r\n                break;\r\n            case 65: // A\r\n                this.setState({a: false});\r\n                break;\r\n            case 68: // D\r\n                this.setState({d: false});\r\n                break;\r\n        }\r\n    }\r\n\r\n    render() {\r\n        return <div className=\"controls\">\r\n            [<span className={`${this.state.w ? 'pressed' : ''} key` }>W</span>]\r\n            [<span className={`${this.state.s ? 'pressed' : ''} key` }>S</span>]\r\n            [<span className={`${this.state.a ? 'pressed' : ''} key` }>A</span>]\r\n            [<span className={`${this.state.d ? 'pressed' : ''} key` }>D</span>]\r\n        </div>;\r\n    }\r\n}","import React from \"react\";\r\nimport { HudPanel, Grid, Controls } from \"../../components\";\r\nimport \"./BlastZone.scss\";\r\n\r\ninterface BlastZoneState {\r\n  gridX: number,\r\n  gridY: number,\r\n}\r\nexport default class BlastZone extends React.Component<void, BlastZoneState> {\r\n  constructor(props: void) {\r\n    super(props);\r\n    this.state = {\r\n      gridX: 0,\r\n      gridY: 0,\r\n    }\r\n  }\r\n  componentDidMount() {\r\n  }\r\n\r\n  onControlPress(key) {\r\n    let deltaX = 0;\r\n    let deltaY = 0;\r\n    switch(key) {\r\n      case \"w\":\r\n        deltaY = -1;\r\n        break;\r\n      case \"s\":\r\n        deltaY = 1;\r\n        break;\r\n\r\n      case \"a\":\r\n        deltaX = -1;\r\n        break;\r\n      case \"d\":\r\n        deltaX = 1;\r\n        break;\r\n    }\r\n\r\n    console.log(key);\r\n    this.setState(prevState => {\r\n      return {\r\n        gridX: prevState.gridX + deltaX,\r\n        gridY: prevState.gridY + deltaY\r\n      };\r\n    })\r\n  }\r\n\r\n  render() {\r\n\r\n    const controls = <Controls\r\n      keys={['W', 'S', 'A', 'D']}\r\n      onKeyPress={(e) => this.onControlPress(e)}\r\n      ></Controls>\r\n    const console = <></>;\r\n    const statusIndicators = <></>;\r\n\r\n    return <div className=\"blast-zone\">\r\n      <div className=\"top-row\">\r\n        <HudPanel title=\"Controls\">\r\n          {controls}\r\n        </HudPanel>\r\n        <HudPanel title=\"Console\">\r\n          {console}\r\n        </HudPanel>\r\n        <HudPanel title=\"Status Indicators\">\r\n          {statusIndicators}\r\n        </HudPanel>\r\n      </div>\r\n      <div className=\"mid-row\">\r\n        <HudPanel title=\"Tactical Grid\">\r\n          <Grid width={100} height={100} startAt={[this.state.gridX,this.state.gridY]}></Grid>\r\n        </HudPanel>\r\n      </div>\r\n\r\n      <div className=\"bottom-row\">\r\n        <HudPanel title=\"OhWell\">\r\n          <span>:)</span>\r\n        </HudPanel>\r\n      </div>\r\n    </div>;\r\n  }\r\n}","import React from \"react\";\r\nimport { HudPanel, Grid, Controls, Game } from \"./components\";\r\nimport BlastZone from \"./screens/BlastZone\";\r\ninterface AppState {\r\n  loadedScene: string\r\n}\r\nexport default class App extends React.Component<void, AppState> {\r\n\r\n  scenes:{} = {\r\n    BlastZone,\r\n    Game,\r\n  }\r\n  SelectedScene = null;\r\n  constructor(props: void) {\r\n    super(props);\r\n    this.state = {\r\n      loadedScene: 'Game'\r\n    }\r\n    this.handleChange.bind(this);\r\n  }\r\n  componentDidMount() {\r\n  }\r\n\r\n  handleChange(e) {\r\n    // e.target.value;\r\n    console.log(e)\r\n    console.log(e.target)\r\n    console.log(e.target.value)\r\n    const sceneToLoad = e.target.value;\r\n    this.setState(prevState => {return {loadedScene: sceneToLoad}});\r\n  }\r\n\r\n  render() {\r\n    let SelectedScene = this.scenes[this.state.loadedScene];\r\n    return <div className=\"app\">\r\n      <div className=\"meta-bar\">\r\n        <div className=\"screen-switch\">\r\n          <span>Select screen: </span>\r\n          <select value={this.state.loadedScene} onChange={(e)=>this.handleChange(e)}>\r\n            <option value=\"BlastZone\">BlastZone</option>\r\n            <option value=\"Game\">Game</option>\r\n          </select>\r\n        </div>\r\n      </div>\r\n      <SelectedScene/>\r\n    </div>\r\n  }\r\n}","import React from \"react\";\r\nimport { render } from \"react-dom\";\r\nimport Game from \"./components/Game\";\r\nimport BlastZone from \"./screens/BlastZone\";\r\nimport App from \"./App\";\r\n\r\nimport \"./style.scss\";\r\n\r\n// Rendering the top-level Game component\r\n// render(<Game />, document.getElementById(\"root\"));\r\nrender(<App />, document.getElementById(\"root\"));\r\n"],"sourceRoot":""}